<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lịch Công Giáo</title>
   <style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f5f5f5;
        margin: 0;
        padding: 0;
    }

    .calendar-header {
        background-color: #007bff;
        color: white;
        padding: 15px;
        text-align: center;
        font-size: 24px;
    }

    .calendar-content {
        background-color: white;
        border-radius: 10px;
        margin: 20px;
        padding: 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        text-align: center;
    }

    .date-large {
        font-size: 100px;
        color: green;
        margin: 0;
    }

    .date-small {
        font-size: 28px;
        color: #666;
        margin: 0;
    }

    .feast-info-container {
        display: flex; /* Sử dụng flexbox để các phần tử nằm cùng hàng */
        justify-content: center; /* Căn giữa theo chiều ngang */
        align-items: center; /* Căn giữa theo chiều dọc */
        text-align: center; /* Căn giữa nội dung văn bản */
        gap: 15px; /* Khoảng cách giữa thông tin lễ và lễ phục */
    }

    .feast-info {
        margin: 0; /* Đảm bảo không có khoảng cách thừa */
    }

    .feast-info-container div {
        margin: 0; /* Đảm bảo không có khoảng cách thừa */
    }

    .readings {
        margin: 5px 0;
        text-align: center;
    }

    .readings div {
        margin-bottom: 5px;
    }

    /* Phần cho điều khiển hiển thị */
    .controls-container {
        display: flex;
        justify-content: space-around;
        align-items: center;
        margin: 20px 0;
    }

    .control-item {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    button {
        padding: 5px 10px;
        background-color: #007BFF;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 4px;
        font-size: 14px;
    }

    button:hover {
        background-color: #0056b3;
    }

    input[type="date"], input[type="number"] {
        padding: 5px;
        border-radius: 4px;
        border: 1px solid #ccc;
        font-size: 14px;
    }

    .bottom-nav {
        display: flex;
        justify-content: space-around;
        background-color: #007bff;
        color: white;
        padding: 15px;
        position: fixed;
        width: 100%;
        bottom: 0;
    }

    .bottom-nav div {
        text-align: center;
        cursor: pointer;
    }

    .bottom-nav div:hover {
        background-color: #0056b3;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 30px;
    }

    table, th, td {
        border: 1px solid black;
    }

    th, td {
        padding: 8px;
        text-align: center;
    }

    th {
        background-color: #f2f2f2;
    }

    .feast-bold {
        font-weight: bold;
    }

    .bg-Tr { background-color: white; }  /* Trắng */
    .bg-Tm { background-color: #d8bfd8; } /* Tím nhạt */
    .bg-Đ { background-color: #ff6347; } /* Đỏ nhẹ */
    .bg-X { background-color: lightgreen; } /* Xanh lá cây */
    .week-separator {
        height: 1px;
        border-top: 10px solid #ccc;
    }
    .info {
    color: rgb(2, 14, 95); /* Đặt màu cho văn bản trong thẻ p có class info */
    font-weight: bold; /* Tùy chọn, đặt văn bản in đậm */
    font-style: italic; /* Tùy chọn, đặt văn bản nghiêng */
    background-color: rgb(148, 250, 243); /* Đặt màu nền cho thẻ p */
    padding: 10px; /* Tùy chọn, thêm khoảng cách bên trong thẻ */
    border-radius: 5px; /* Tùy chọn, thêm góc bo tròn */
}

    /* Modal container */
.modal {
            display: none; /* Modal mặc định ẩn */
            position: fixed; /* Giữ modal ở giữa màn hình */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000; /* Đảm bảo modal luôn nằm trên các phần tử khác */
            background-color: #f5f7b3;
            padding: 20px;
            box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.3);
            width: 90%; /* Điều chỉnh cho modal lớn hơn */
            max-width: 800px; /* Điều chỉnh giới hạn chiều rộng tối đa */
            max-height: 80%; /* Giới hạn chiều cao modal */
            overflow-y: auto; /* Thêm thanh cuộn dọc khi nội dung vượt quá chiều cao */
        }

        /* Nội dung của modal */
        .modal-content {
            padding: 20px;
            text-align: left;
        }

        /* Nút "X" để đóng modal */
.close {
    position: absolute;
    top: 10px;
    right: 15px;
    color: #aaa;
    font-size: 24px;
    font-weight: bold;
    cursor: pointer;
}

.close:hover,
.close:focus {
    color: #000;
    text-decoration: none;
    cursor: pointer;
}


        /* Overlay nền mờ */
        .overlay {
            display: none; /* Ẩn overlay mặc định */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 999; /* Phía sau modal */
        }

        /* Hiển thị modal và overlay */
        .modal.show, .overlay.show {
            display: block;
        }
br {
    line-height: 2;
}
.readable {
    cursor: pointer; /* Chuyển con trỏ thành dạng pointer khi hover */
}
.readable {
    cursor: pointer; /* Con trỏ sẽ thay đổi thành dạng pointer khi hover */
    transition: color 0.3s ease; /* Tạo hiệu ứng chuyển màu mượt mà */
}

.readable:hover {
    color: blue; /* Thay đổi màu chữ khi hover, bạn có thể đổi thành màu khác */
    font-weight: bold; /* Thêm hiệu ứng đậm khi hover */
}


    /* Media Queries cho thiết bị di động */
    @media (max-width: 768px) {
        .controls-container {
            flex-direction: column; /* Chuyển từ hàng ngang sang cột dọc */
            align-items: flex-start; /* Căn lề trái cho các phần tử */
        }

        .control-item {
            width: 100%; /* Đảm bảo phần tử kéo dài đủ chiều rộng */
            justify-content: space-between; /* Chia đều không gian giữa nhãn và input/button */
        }

        button, input[type="date"], input[type="number"] {
            width: 100%; /* Kéo dài các nút và trường nhập liệu theo chiều rộng */
            margin-bottom: 10px; /* Thêm khoảng cách giữa các nút */
        }

        .calendar-content {
            margin: 10px;
            padding: 10px;
        }

        .date-large {
            font-size: 70px; /* Giảm kích thước chữ cho màn hình nhỏ */
        }
    }

</style>

<!-- Tích hợp các tệp JS -->
<script src="js/saintcelebration.js"></script> 
<script src="js/calculateLunarSolar.js"></script> 
<script src="js/calculateChasuble.js"></script> 
<script src="js/calculateFeasts.js"></script> 
<script src="js/calculateBasic.js"></script> 
<script src="js/calculatenumberSunday.js"></script> 
<script src="Reading/Sunday.js"></script> 
<script src="js/calculatebibleReads.js"></script>
<script src="Reading/DailySeason.js"></script>
<script src="Reading/DailyOrdinary1.js"></script>
<script src="Reading/DailyOrdinary2.js"></script>
<script src="Reading/SaintsBible.js"></script>
<script src="js/secondfeast.js"></script> <!-- Thêm secondfeast.js vào -->

<body>

<div class="calendar-header">
    Lịch Công Giáo
</div>
<div id="readingModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span> <!-- Thêm dấu "X" đóng modal -->
        <h3>Bài Đọc Ngày Lễ</h3>
        <div id="readingContent"></div>
        <button class="close-btn" onclick="closeModal()">Đóng</button>
    </div>
</div>

<div id="modalOverlay" class="overlay" onclick="closeModal()"></div>

<!-- Hiển thị thông tin ngày hôm nay hoặc ngày đã chọn -->
<div class="calendar-content">
    <p class="date-small" id="current-month-year"></p>
    <p class="date-large" id="current-date">1</p>

    <!-- Thông tin lễ và Lễ Phục cùng nằm trên một hàng và được căn giữa -->
    <div class="feast-info-container">
        <p class="feast-info" id="feast-info"></p>
    </div>
   
    <p class="info">
        <span id="info"></span> 
    </p>
    <p class="readings">
        <span id="reading1"></span> <span id="psalm"></span> <span id="reading2"></span> <span id="gospel"></span>
    </p>
    

    <!-- Thêm phần hiển thị lễ vọng -->
    <div>
        <p id="second-feast-info"></p> <!-- Phần hiển thị lễ vọng -->
    </div>
</div>

<!-- Chọn ngày và các nút Lịch -->
<div class="controls-container">
    <!-- Chọn ngày -->
    <div class="control-item">
        <label for="inputDate">Chọn ngày: </label>
        <input type="date" id="inputDate">
        <button onclick="getFeastForSelectedDate()">Xem lễ và áo lễ</button>
    </div>

    <!-- Lịch Tuần -->
    <div class="control-item">
        <button onclick="displayWeekInfo()">Lịch Tuần</button>
    </div>

    <!-- Lịch Tháng -->
    <div class="control-item">
        <button onclick="displayMonthInfo()">Lịch Tháng</button>
    </div>
    <!-- Lịch Năm -->
    <div class="control-item">
        <label for="yearInput">Nhập Năm: </label>
        <input type="number" id="yearInput" value="2024">
        <button onclick="generateReport()">Tạo Lịch </button>
    </div>
</div>

<h2>Lịch Phụng vụ <span id="yearDisplay"></span></h2>

<!-- Bảng hiển thị thông tin -->
<table>
    <thead>
        <tr>
            <th>Ngày (Solar)</th>
            <th>Ngày (Âm lịch)</th>
            <th>Màu Áo Lễ</th>
            <th>Thông tin Ngày Lễ và Bài Đọc</th>
        </tr>
    </thead>
    <tbody id="reportTableBody">
        <!-- Nội dung sẽ được chèn vào đây -->
    </tbody>
</table>

</body>
</html>

<script>
function displayDateInfo(date) {
    const selectedDate = date ? new Date(date) : new Date(); // Sử dụng ngày đã chọn hoặc ngày hiện tại
    const year = selectedDate.getFullYear();
    const month = selectedDate.getMonth() + 1;
    const day = selectedDate.getDate();

    // Hiển thị ngày tháng hiện tại hoặc đã chọn
    document.getElementById("current-date").textContent = day;
    document.getElementById("current-month-year").textContent = `${month}/${year}`;

    // Lấy thông tin lễ và bài đọc
    const feasts = calculateFeasts(year);
    const feast = getFeastForDay(selectedDate, feasts);
    document.getElementById("feast-info").innerHTML = feast ? formatFeastName(feast.name) : 'Không có lễ đặc biệt';

    // Lấy thông tin bài đọc từ hàm showfordayContent với định dạng ngày day/month/year
    const readingContent = showfordayContent(selectedDate)?.split('; ') || [];
    const info = showfordayContentinfo(selectedDate)
    
    const solarDate = selectedDate.toISOString();

    // Hiển thị 1 hàng ngang với các phần đậm và không đậm
    if (readingContent.length === 4) {
        document.getElementById("info").innerHTML = `<strong><em>${info}</em></strong>`;
        document.getElementById("reading1").innerHTML = `
            <div class="readable" onclick="showReadingContent('${solarDate}')">
                <strong>${readingContent[0] || ''}</strong> ${readingContent[1] || ''} 
                ${readingContent[2] || ''}<strong> ${readingContent[3] || ''}
            </div>`;
    } else if (readingContent.length === 3) {
        document.getElementById("info").innerHTML = `<strong><em>${info}</em></strong>`;
        document.getElementById("reading1").innerHTML = `
            <div class="readable" onclick="showReadingContent('${solarDate}')">
                <strong>${readingContent[0] || ''}</strong> ${readingContent[1] || ''} 
                <strong>${readingContent[2] || ''}
            </div>`;
    } else {
        // Trường hợp không có đủ dữ liệu
        return;
    }

    // Hiển thị các lễ vọng (second feasts)
    const secondFeasts = getSecondFeastsForDate(day, month, year);
    document.getElementById("second-feast-info").innerHTML = secondFeasts.length 
        ? secondFeasts.map(secondFeast => formatFeastName(secondFeast.name)).join('<br>')
        : '';
}

// Khi trang được tải, hiển thị thông tin ngày hôm nay
window.onload = function() {
    displayDateInfo();
};

// Khi trang được tải, hiển thị thông tin ngày hôm nay
window.onload = function() {
    displayDateInfo();
};


// Hàm cập nhật thông tin khi chọn ngày từ input
function getFeastForSelectedDate() {
    const inputDate = document.getElementById('inputDate').value;
    if (!inputDate) {
        alert('Vui lòng chọn một ngày.');
        return;
    }
    displayDateInfo(inputDate); // Cập nhật thông tin dựa trên ngày đã chọn
}
// hiển thị tuần 
function displayWeekInfo() {
    const today = new Date();
    const startOfWeek = new Date(today.setDate(today.getDate() - today.getDay())); // Chủ Nhật đầu tuần
    let currentDay = new Date(startOfWeek);
    let lastWeekNumber = -1; // Để lưu số tuần trước đó

    // Cập nhật nội dung của <span id="yearDisplay"> để hiển thị thông tin tuần
    const yearDisplayElement = document.getElementById('yearDisplay');
    const startDateString = `${startOfWeek.getDate()}/${startOfWeek.getMonth() + 1}/${startOfWeek.getFullYear()}`;
    const endOfWeek = new Date(startOfWeek);
    endOfWeek.setDate(startOfWeek.getDate() + 6);
    const endDateString = `${endOfWeek.getDate()}/${endOfWeek.getMonth() + 1}/${endOfWeek.getFullYear()}`;
    yearDisplayElement.textContent = `từ ngày ${startDateString} đến ${endDateString}`;

    const reportTableBody = document.getElementById('reportTableBody');
    reportTableBody.innerHTML = ''; // Xóa dữ liệu cũ trong bảng

    // Hiển thị thông tin cho từng ngày trong tuần
    for (let i = 0; i < 7; i++) {
        const year = currentDay.getFullYear();
        const month = currentDay.getMonth() + 1;
        const day = currentDay.getDate();

        const feasts = calculateFeasts(year);
        const chasuble = calculateChasuble(year).getChasubleForDay(currentDay);
        const feast = getFeastForDay(currentDay, feasts);
                // Tính số tuần hiện tại để thêm ngăn cách giữa các tuần
        const currentWeekNumber = Math.ceil((currentDay.getDate() - currentDay.getDay() + 1) / 7);
        if (currentWeekNumber !== lastWeekNumber && lastWeekNumber !== -1) {
            const separatorRow = document.createElement('tr');
            separatorRow.classList.add('week-separator');
            const separatorCell = document.createElement('td');
            separatorCell.colSpan = 4; // Số cột trong bảng
            separatorRow.appendChild(separatorCell);
            reportTableBody.appendChild(separatorRow);
        }
        lastWeekNumber = currentWeekNumber;

        // Tạo hàng mới trong bảng
        const row = document.createElement('tr');

        // Nếu là Chủ Nhật, thêm hiệu ứng 3D
        if (currentDay.getDay() === 0) {
            row.classList.add('sunday');
        }

        // Gán lớp màu nền cho hàng theo chasuble
        const chasubleClass = getChasubleClass(chasuble);
        if (chasubleClass) {
            row.classList.add(chasubleClass);
        }

        // Ngày dương lịch
        const solarDateCell = document.createElement('td');
        solarDateCell.textContent = `${day}/${month}/${year}`;
        row.appendChild(solarDateCell);

        // Ngày âm lịch
        const lunarDate = convertToLunarDate({ day, month, year });
        const lunarDateCell = document.createElement('td');
        lunarDateCell.textContent = `${lunarDate.day}/${lunarDate.month}`;
        row.appendChild(lunarDateCell);

        // Màu áo lễ
        const chasubleCell = document.createElement('td');
        chasubleCell.textContent = chasuble || 'Xanh';
        row.appendChild(chasubleCell);

        // Ngày lễ và bài đọc (Feasts & Readings)
        const feastAndReadingCell = document.createElement('td');
        let feastAndReadingContent = '';

        // Nếu có ngày lễ, hiển thị tên lễ
        if (feast) {
            feastAndReadingContent += formatFeastName(feast.name) + '<br>';
        } else {
            feastAndReadingContent += 'Không có lễ đặc biệt<br>';
        }
        // Thêm bài đọc vào sau phần ngày lễ
            const readingContent = showfordayContent(currentDay); // Gọi hàm showfordayContent để lấy nội dung bài đọc
            if (readingContent) {
                feastAndReadingContent += `<div class="readable" onclick="showReadingContent('${currentDay.toISOString()}')">${readingContent}</div>`;
            } else {
                feastAndReadingContent += 'Không có bài đọc';  // Nếu không có bài đọc
                }
        
        // Tính toán và thêm lễ vọng (second feast)
        const secondFeasts = getSecondFeastsForDate(day, month, year);
        secondFeasts.forEach(secondFeast => {
            feastAndReadingContent += '<br>' + formatFeastName(secondFeast.name) + '<br>'; 
        });
        feastAndReadingCell.innerHTML = feastAndReadingContent;
        row.appendChild(feastAndReadingCell);
             // Thêm hàng vào bảng
        reportTableBody.appendChild(row);

        // Chuyển sang ngày tiếp theo
        currentDay.setDate(currentDay.getDate() + 1);
    }
}

// Hiển thị tháng
function displayMonthInfo() {
    const today = new Date();
    const year = today.getFullYear();
    const month = today.getMonth() + 1;
    const daysInMonth = new Date(year, month, 0).getDate(); // Số ngày trong tháng

    // Cập nhật nội dung của <span id="yearDisplay"> thay vì xóa thẻ <h2>
    const yearDisplayElement = document.getElementById('yearDisplay');
    yearDisplayElement.textContent = `Tháng ${month}/${year}`;

    const reportTableBody = document.getElementById('reportTableBody');
    reportTableBody.innerHTML = ''; // Xóa dữ liệu cũ trong bảng

    let lastWeekNumber = -1; // Biến lưu số tuần trước đó

    // Hiển thị thông tin cho từng ngày trong tháng
    for (let day = 1; day <= daysInMonth; day++) {
        const currentDate = new Date(year, month - 1, day);

        const feasts = calculateFeasts(year);
        const chasuble = calculateChasuble(year).getChasubleForDay(currentDate);
        const feast = getFeastForDay(currentDate, feasts);
        //const readingDateString = `${year}-${month}-${day}`;
        //const reading = getReadingForDate(readingDateString);

        const currentWeekNumber = Math.ceil((currentDate.getDate() - currentDate.getDay() + 1) / 7); // Số tuần trong tháng

        // Thêm ngăn cách giữa các tuần
        if (currentWeekNumber !== lastWeekNumber && lastWeekNumber !== -1) {
            const separatorRow = document.createElement('tr');
            separatorRow.classList.add('week-separator');
            const separatorCell = document.createElement('td');
            separatorCell.colSpan = 4; // Số cột trong bảng
            separatorRow.appendChild(separatorCell);
            reportTableBody.appendChild(separatorRow);
        }
        lastWeekNumber = currentWeekNumber;

        // Tạo hàng mới trong bảng
        const row = document.createElement('tr');

        // Nếu là Chủ Nhật, thêm hiệu ứng 3D
        if (currentDate.getDay() === 0) {
            row.classList.add('sunday');
        }

        // Gán lớp màu nền cho hàng theo chasuble
        const chasubleClass = getChasubleClass(chasuble);
        if (chasubleClass) {
            row.classList.add(chasubleClass);
        }

        // Ngày dương lịch
        const solarDateCell = document.createElement('td');
        solarDateCell.textContent = `${day}/${month}/${year}`;
        row.appendChild(solarDateCell);

        // Ngày âm lịch
        const lunarDate = convertToLunarDate({ day, month, year });
        const lunarDateCell = document.createElement('td');
        lunarDateCell.textContent = `${lunarDate.day}/${lunarDate.month}`;
        row.appendChild(lunarDateCell);

        // Màu áo lễ
        const chasubleCell = document.createElement('td');
        chasubleCell.textContent = chasuble || 'Xanh';
        row.appendChild(chasubleCell);

        // Ngày lễ và bài đọc (Feasts & Readings)
        const feastAndReadingCell = document.createElement('td');
        let feastAndReadingContent = '';

          
        // Nếu có ngày lễ, hiển thị tên lễ
        if (feast) {
            feastAndReadingContent += formatFeastName(feast.name) + '<br>';
        } else {
            feastAndReadingContent += 'Không có lễ đặc biệt<br>';
        }
        // Thêm bài đọc vào sau phần ngày lễ
            const readingContent = showfordayContent(currentDate); // Gọi hàm showfordayContent để lấy nội dung bài đọc
  
            if (readingContent) {
                feastAndReadingContent += `<div class="readable" onclick="showReadingContent('${currentDate.toISOString()}')">${readingContent}</div>`;
            } else {
                feastAndReadingContent += 'Không có bài đọc';  // Nếu không có bài đọc
                }
        
        // Tính toán và thêm lễ vọng (second feast)
        const secondFeasts = getSecondFeastsForDate(day, month, year);
        secondFeasts.forEach(secondFeast => {
            feastAndReadingContent += '<br>' + formatFeastName(secondFeast.name) + '<br>'; 
        });
        feastAndReadingCell.innerHTML = feastAndReadingContent;
        row.appendChild(feastAndReadingCell);
        // Thêm hàng vào bảng
        reportTableBody.appendChild(row);
    }
}


// Hàm để sinh báo cáo cho năm đã nhập
function generateReport() {
const year = document.getElementById('yearInput').value;
const ABC = getLiturgicalYear(year);
document.getElementById('yearDisplay').textContent = year + ' Năm ' + (ABC) ;


    const reportTableBody = document.getElementById('reportTableBody');
    reportTableBody.innerHTML = ''; // Xóa dữ liệu cũ
    const today = new Date();
    //const year = today.getFullYear();
    const month = today.getMonth() + 1;
    const day = today.getDate();
    const solarDateString = `${day}/${month}/${year}`;
    const solarDateParsed = parseDate(solarDateString);
    const lunarDate = convertToLunarDate(solarDateParsed); // Chuyển đổi ngày dương lịch sang âm lịch

    // Lấy thông tin lễ và bài đọc
    const chasubleData = calculateChasuble(year); // Gọi hàm calculateChasuble
    const feasts = calculateFeasts(year); // Lấy các ngày lễ
    const feast = getFeastForDay(today, feasts);
    const readingDateString = `${year}-${month}-${day}`;

    let lastWeekNumber = -1; // Để theo dõi tuần

    for (let month = 1; month <= 12; month++) {
        for (let day = 1; day <= 31; day++) {
            const solarDateString = `${day}/${month}`;
            const solarDateParsed = parseDate(`${day}/${month}/${year}`); // Chuyển đổi chuỗi ngày thành đối tượng
            const solarDate = new Date(solarDateParsed.year, solarDateParsed.month - 1, solarDateParsed.day);

            if (solarDate.getMonth() + 1 !== month) break; // Đảm bảo không vượt quá số ngày của tháng

            const lunarDate = convertToLunarDate(solarDateParsed); // Chuyển đổi ngày dương lịch sang âm lịch

            const chasuble = chasubleData.getChasubleForDay(solarDate); // Lấy màu áo lễ
            const feast = getFeastForDay(solarDate, feasts); // Lấy ngày lễ nếu có

            const codeNumber = calculatenumberSunday(year).getCodeNumberForDay(solarDate);
            const currentWeekNumber = Math.ceil((solarDate.getDate() - solarDate.getDay() + 1) / 7); // Tính số tuần

            // Thêm ngăn cách giữa các tuần
            if (currentWeekNumber !== lastWeekNumber && lastWeekNumber !== -1) {
                const separatorRow = document.createElement('tr');
                separatorRow.classList.add('week-separator');
                const separatorCell = document.createElement('td');
                separatorCell.colSpan = 6; // Số cột trong bảng
                separatorRow.appendChild(separatorCell);
                reportTableBody.appendChild(separatorRow);
            }
            lastWeekNumber = currentWeekNumber;

            const row = document.createElement('tr');

            // Nếu là Chủ Nhật, thêm hiệu ứng 3D
            if (solarDate.getDay() === 0) {
                row.classList.add('sunday');
            }

            // Gán lớp màu nền cho hàng theo chasuble
            const chasubleClass = getChasubleClass(chasuble);
            if (chasubleClass) {
                row.classList.add(chasubleClass);
            }

            // Ngày dương lịch
            const solarDateCell = document.createElement('td');
            solarDateCell.textContent = `${day}/${month}/${year}`;
            row.appendChild(solarDateCell);

            // Ngày âm lịch
            const lunarDateCell = document.createElement('td');
            lunarDateCell.textContent = `${lunarDate.day}/${lunarDate.month}`;
            row.appendChild(lunarDateCell);

            // Màu áo lễ
            const chasubleCell = document.createElement('td');
            chasubleCell.textContent = chasuble;
            row.appendChild(chasubleCell);
            
            // Ngày lễ và bài đọc (Feasts & Readings)
            const feastAndReadingCell = document.createElement('td');
            let feastAndReadingContent = '';

            // Nếu có ngày lễ, hiển thị tên lễ
            if (feast) {
                feastAndReadingContent += formatFeastName(feast.name) + '<br>';
            }

            // Thêm bài đọc vào sau phần ngày lễ
                const readingContent = showfordayContent(solarDate); // Gọi hàm showfordayContent để lấy nội dung bài đọc
                if (readingContent) {
                    feastAndReadingContent += `<div class="readable" onclick="showReadingContent('${solarDate.toISOString()}')">${readingContent}</div>`;
                } else {
                    feastAndReadingContent += 'Không có bài đọc';  // Nếu không có bài đọc
                    }
            
            // Tính toán và thêm lễ vọng (second feast)
            const secondFeasts = getSecondFeastsForDate(day, month, year);
            secondFeasts.forEach(secondFeast => {
                feastAndReadingContent += '<br>' + formatFeastName(secondFeast.name) + '<br>'; 
            });
            feastAndReadingCell.innerHTML = feastAndReadingContent;
            row.appendChild(feastAndReadingCell);

            reportTableBody.appendChild(row);
        }
    }
}

// xuống 1.5 hàng khi gặp ký tự trong bài đọc
function formatWithLineBreaks(text) {
    if (!text) return ''; // Kiểm tra chuỗi trống
    // Sử dụng div với line-height để tạo khoảng cách dòng lớn hơn
    return text.replace(/(\r\n|\n|\r)/g, '<div style="line-height: 2;"></div>'); 
}


// Hàm phụ trợ để định dạng từng bài đọc (bài đọc I, II, Tin Mừng)
function formatReadingPart(title, readingPart) {
    if (!readingPart) return `<strong style="color: red;"> ${title}:</strong> Not available<br><br>`;
    
    return `
<br><strong style="color: red;">${title}:</strong> ${formatWithLineBreaks(readingPart.excerpt)} <br>
        <br><em>${formatWithLineBreaks(readingPart.info || '')}</em><br>
        <br><strong>${formatWithLineBreaks(readingPart.title || '')}</strong><br>
        <br>${formatWithLineBreaks(readingPart.content || '')}<br>
        <br><strong>${formatWithLineBreaks(readingPart.end || '')}</strong><br><br>
    `;
}

// Hàm phụ trợ để định dạng phần Đáp ca
function formatPsalms(psalms) {
    if (!psalms) return '<strong>Đáp ca:</strong> Not available<br><br>';
    
    return `
        <strong style="color: red;"> Đáp ca:</strong> ${formatWithLineBreaks(psalms.excerpt)} <br>
        <br><strong>${formatWithLineBreaks(psalms.response)}</strong><br>
        <br><em>${psalms.verses.map(formatWithLineBreaks).join('<br><br>')}</em><br><br>
    `;
}

// Hàm phụ trợ để định dạng phần Xướng trước Tin Mừng
function formatAlleluia(alleluia) {
    if (!alleluia) return '<strong style="color: red;">Xướng trước Tin Mừng:</strong> Not available<br><br>';
    
    return `
        <strong style="color: red;"> Xướng trước Tin Mừng:</strong> ${formatWithLineBreaks(alleluia.verse)} <br>
        <br><strong>${formatWithLineBreaks(alleluia.content)}</strong><br><br>
    `;
}

// Hàm hiển thị nội dung bài đọc
function showReadingContent(dateString) {
    const date = new Date(dateString);  // Chuyển đổi chuỗi thành đối tượng Date
    const reading = getBibleByFourDigitCode(date);  // Lấy bài đọc
    if (reading) {
        // Biến lưu trữ nội dung bài đọc với các điều kiện kiểm tra từng phần
        const readingContent = `
            ${formatReadingPart('Bài Đọc I', reading.firstReading)}
            ${formatPsalms(reading.psalms)}
            ${reading.secondReading ? formatReadingPart('Bài Đọc II', reading.secondReading) : ''} 
            ${formatAlleluia(reading.alleluia)}
            ${formatReadingPart('Tin Mừng', reading.gospel)}
        `;

        // Hiển thị nội dung bài đọc trong phần tử HTML có ID là "readingContent"
        document.getElementById("readingContent").innerHTML = readingContent;
    } else {
        // Không có bài đọc, hiển thị thông báo
        document.getElementById("readingContent").innerHTML = "Không có bài đọc.";
    }

    // Hiển thị modal và overlay
    document.getElementById("readingModal").style.display = "block"; 
    document.getElementById("modalOverlay").style.display = "block"; 
}
// Hàm hiển thị tên bài đọc
function showfordayContent(date) {
    const reading = getBibleByFourDigitCode(date); // Gọi hàm để lấy bài đọc
    if (reading) {
        // Loại bỏ (Năm I) hoặc (Năm II) bất kể chữ hoa hay chữ thường
        const reading1 = reading.firstReading ? `${reading.firstReading.excerpt.replace(/\(năm i\)|\(năm ii\)/gi, '').trim()}; ` : 'Không có Bài Đọc I';
        const psalm = reading.psalms ? `${reading.psalms.excerpt}; ` : 'Không có Thánh Vịnh';
        const reading2 = reading.secondReading ? `${reading.secondReading.excerpt}; ` : '';
        const gospel = reading.gospel ? `${reading.gospel.excerpt}` : 'Không có Tin Mừng';

        // Kết hợp tất cả các phần vào một chuỗi
        const readingContent = `${reading1}${psalm}${reading2}${gospel}`;


        // Trả về chuỗi nội dung bài đọc
        return readingContent;
    } else {
        return; // Trả về chuỗi thông báo
    }
}
function showfordayContentinfo(date) {
    const reading = getBibleByFourDigitCode(date); // Gọi hàm để lấy bài đọc
    if (reading) {
       
        const Infogospel = reading.gospel ? `${reading.gospel.info}` : '';
         // Trả về chuỗi nội dung bài đọc
        return Infogospel;
    } else {
        return; // Trả về chuỗi thông báo
    }
}

        // Hàm đóng modal
        function closeModal() {
            document.getElementById("readingModal").style.display = "none";
            document.getElementById("modalOverlay").style.display = "none";
        }
  // Hàm đóng modal
  function closeModal() {
       document.getElementById("readingModal").style.display = "none";
       document.getElementById("modalOverlay").style.display = "none";
   }
// Thêm sự kiện cho nút "X" đóng modal
document.querySelector('.close').onclick = function() {
    closeModal();
}

        // Hàm định dạng tên lễ theo yêu cầu
        function formatFeastName(feastName) {
            if (feastName.includes("Lễ nhớ")) {
                const feastParts = feastName.split('.');
                if (feastParts.length > 1) {
                    const firstPart = feastParts[0] + '.';
                    const secondPart = feastParts.slice(1).join('.');
                    return `${firstPart} <span class="feast-bold">${secondPart}</span>`;
                } else {
                    return feastName;
                }
            } else if (feastName.includes("Lễ kính")) {
                return feastName.replace("Lễ kính", `<span class="feast-bold">Lễ kính</span>`);
            } else if (feastName.includes("CHÚA NHẬT")) {
                const feastParts = feastName.split('.');
                if (feastParts.length > 1) {
                    const firstPart = feastParts[0] + '.';
                    const secondPart = feastParts.slice(1).join('.');
                    return `<span class="feast-bold"> ${firstPart}</span> ${secondPart}`;
                }
            } else if (feastName.includes("Lễ trọng")) {
                return `<span class="feast-bold">${feastName}</span>`;
            }
            return feastName;
        }

                // Hàm chuyển đổi màu Chasuble thành lớp CSS cho màu nền
        function getChasubleClass(chasuble) {
            switch (chasuble) {
                case 'Tr': return 'bg-Tr'; // Màu trắng
                case 'Tm': return 'bg-Tm'; // Màu tím
                case 'Đ': return 'bg-Đ';   // Đỏ nhẹ
                case 'X': return 'bg-X';   // Xanh lá cây
                default: return '';        // Không có màu
            }
        }

        // Hàm chuyển chuỗi ngày thành đối tượng ngày
        function parseDate(dateString) {
            const [day, month, year] = dateString.split('/').map(Number);
            return { day, month, year };
        }

        // Hàm chuyển đổi ngày dương lịch sang ngày âm lịch
        function convertToLunarDate({ day, month, year }) {
            const lunarDate = getLunarDate(day, month, year);
            return lunarDate ? { day: lunarDate.day, month: lunarDate.month, year: lunarDate.year } : { day: '', month: '' };
        }

        // Hàm lấy thông tin ngày lễ từ danh sách feasts
        function getFeastForDay(solarDate, feasts) {
            for (let feast of feasts) {
                if (feast.date && solarDate.getDate() === feast.date.getDate() &&
                    solarDate.getMonth() === feast.date.getMonth() &&
                    solarDate.getFullYear() === feast.date.getFullYear()) {
                    return feast;
                }
            }
            return null;
        }
        // Hàm lấy lễ vọng từ secondfeast.js
        function getSecondFeastsForDate(day, month, year) {
            const secondFeasts = calculateSecondFeasts(year);  // Giả sử hàm này đã có trong secondfeast.js
            return secondFeasts.filter(feast => 
                feast.date.getDate() === day && 
                feast.date.getMonth() + 1 === month
            );
        }

const liturgicalYears = ['A', 'B', 'C'];

// Hàm tính toán và trả về chu kỳ năm phụng vụ (A, B hoặc C)
function getLiturgicalYear(year) {
    const startYear = 2020; // Năm bắt đầu cho chu kỳ
    const cycleLength = 3;  // Chu kỳ lặp lại mỗi 3 năm
    const yearOffset = year - startYear;
    const cycle = (yearOffset % cycleLength + cycleLength) % cycleLength;
    return liturgicalYears[cycle];
}

</script>

</body>
</html>
