<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lunar and Solar Calendar Report</title>
    <script src="js/saintcelebration.js"></script> 
    <script src="js/calculateLunarSolar.js"></script> 
    <script src="js/calculateChasuble.js"></script> 
    <script src="js/calculateFeasts.js"></script> 
    <script src="js/calculateBasic.js"></script> 
    <script src="js/calculatenumberSunday.js"></script> 
    <script src="js/calculatenumberSecondary.js"></script>   
    <script src="js/calculateReading.js"></script>
    <script src="Reading/Sunday.js"></script> 
    <script src="js/calculatebibleReads.js"></script>
    <script src="Reading/DailySeason.js"></script>
    <script src="Reading/DailyOrdinary1.js"></script>
    <script src="Reading/DailyOrdinary2.js"></script>
    <script src="Reading/SaintsBible.js"></script>
    <script src="Reading/Optionsaint.js"></script>
    <script src="js/secondfeast.js"></script> <!-- Thêm secondfeast.js vào -->
    <script src="js/calculateOptionbibleReads.js"></script>  

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        .feast-bold {
            font-weight: bold;
        }
        .bg-Tr { background-color: white; }  /* Trắng */
        .bg-Tm { background-color: #d8bfd8; } /* Tím nhạt */
        .bg-Đ { background-color: #ff6347; } /* Đỏ nhẹ */
        .bg-X { background-color: lightgreen; } /* Xanh lá cây */
        .week-separator {
            height: 1px;
            border-top: 10px solid #ccc;
        }
        .red-text {
        color: red;
        }

        /* Modal container */
        .modal {
            display: none; /* Modal mặc định ẩn */
            position: fixed; /* Giữ modal ở giữa màn hình */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000; /* Đảm bảo modal luôn nằm trên các phần tử khác */
            background-color: #f5f7b3;
            padding: 20px;
            box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.3);
            width: 90%; /* Điều chỉnh cho modal lớn hơn */
            max-width: 800px; /* Điều chỉnh giới hạn chiều rộng tối đa */
            max-height: 80%; /* Giới hạn chiều cao modal */
            overflow-y: auto; /* Thêm thanh cuộn dọc khi nội dung vượt quá chiều cao */
        }

        /* Nội dung của modal */
        .modal-content {
            padding: 20px;
            text-align: left;
        }

        /* Nút "X" để đóng modal */
        .close {
            position: absolute;
            top: 10px;
            right: 15px;
            color: #aaa;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }


        /* Overlay nền mờ */
        .overlay {
            display: none; /* Ẩn overlay mặc định */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 999; /* Phía sau modal */
        }

        /* Hiển thị modal và overlay */
        .modal.show, .overlay.show {
            display: block;
        }
        br {
            line-height: 2;
        }
        .readable {
            cursor: pointer; /* Chuyển con trỏ thành dạng pointer khi hover */
        }
        .readable {
            cursor: pointer; /* Con trỏ sẽ thay đổi thành dạng pointer khi hover */
            transition: color 0.3s ease; /* Tạo hiệu ứng chuyển màu mượt mà */
        }

        .readable:hover {
            color: blue; /* Thay đổi màu chữ khi hover, bạn có thể đổi thành màu khác */
            font-weight: bold; /* Thêm hiệu ứng đậm khi hover */
        }

    </style>
</head>
<body>

        <h1>Liturgical Calendar Report</h1>

        <div>
            <h2>Hôm nay</h2>
            <p>Ngày dương lịch: <span id="currentSolarDate"></span></p>
            <p>Ngày âm lịch: <span id="currentLunarDate"></span></p>
            <p>Feast: <span id="currentFeast"></span></p>
            <p>Readings: <span id="currentReadings"></span></p>
        </div>

        <label for="yearInput">Enter Year: </label>
        <input type="number" id="yearInput" value="2024">
        <button onclick="generateReport()">Generate Report</button>

        <h2>Report for Year: <span id="yearDisplay">2024</span></h2>
        
        <table>
            <thead>
                <tr>
                    <th>Ngày (Solar)</th>
                    <th>AL.</th>
                    <th>Màu áo lễ</th>
                    <th>THÁNH LỄ</th> 
                <th>NumberCode</th>   
                <th>SecondaryCode</th><!-- hàm mới viết -->
                </tr>
        </thead>
                <tbody id="reportTableBody">
                    <!-- Dữ liệu sẽ được chèn vào đây -->
                </tbody>
        </table>

        <!--Thẻ để hiển thị bài đọc-->
        <div id="readingModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal()">&times;</span> <!-- Thêm dấu "X" đóng modal với sự kiện -->
                <h3>Bài Đọc Ngày </h3> <!--có hàm cập nhật-->
                <div id="readingContent"></div> <!-- Hiển thị nội dung bài đọc chính -->
                <div id="reading1"></div> <!-- Hiển thị thêm nội dung khác, nếu có -->
                <button class="close-btn" onclick="closeModal()">Đóng</button> <!-- Một nút "Đóng" -->
            </div>
        </div>     
        <div id="modalOverlay" class="overlay" onclick="closeModal()"></div>
    
       <script>

            // Hàm generateTodayInfo để hiển thị thông tin ngày hôm nay
            function generateTodayInfo() {
                const today = new Date();
                const year = today.getFullYear();
                const month = today.getMonth() + 1;
                const day = today.getDate();
                
                const solarDateString = `${day}/${month}/${year}`;
                const solarDateParsed = parseDate(solarDateString);
                const lunarDate = convertToLunarDate(solarDateParsed); // Chuyển đổi ngày dương lịch sang âm lịch

                // Hiển thị ngày dương lịch và âm lịch
                document.getElementById("currentSolarDate").textContent = `${day}/${month}/${year}`;
                document.getElementById("currentLunarDate").textContent = `${lunarDate.day}/${lunarDate.month}`;

                // Lấy thông tin lễ và bài đọc
                const chasubleData = calculateChasuble(year); // Gọi hàm calculateChasuble
                const feasts = calculateFeasts(year); // Lấy các ngày lễ
                const feast = getFeastForDay(today, feasts);
                const reading = getBibleByFourDigitCode(today);

                // Hiển thị thông tin lễ
                if (feast) {
                    document.getElementById("currentFeast").textContent = feast.name || 'Không có lễ đặc biệt';
                } else {
                    document.getElementById("currentFeast").textContent = 'Không có lễ đặc biệt';
                }

                // Hiển thị thông tin bài đọc đơn giản
                if (reading) {
                    const readingContent = `
                        <div class="readable" onclick="showReadingContent('${today.toISOString()}')">
                            <span style="color: red;">${reading.firstReading ? reading.firstReading.excerpt : ''}</span> 
                            <span style="color: blue;">${reading.psalms ? reading.psalms.excerpt : ''}</span> 
                            <span style="color: green;">${reading.secondReading ? reading.secondReading.excerpt : ''}</span> 
                            <span style="color: purple;">${reading.gospel ? reading.gospel.excerpt : ''}</span>
                        </div>
                    `;
                    document.getElementById("currentReadings").innerHTML = readingContent;
                } else {
                    document.getElementById("currentReadings").textContent = 'Không có bài đọc';
                }

                // Tính toán và hiển thị lễ vọng (second feast)
                const secondFeast = getSecondFeastsForDate(today, feasts);
            if (secondFeast) {
                const secondFeastName = formatFeastName(secondFeast.name);
                document.getElementById("currentFeast").innerHTML += `<br>${secondFeastName}`;
            } else {
                //console.log("Không có lễ vọng cho ngày này.");
            }


            }

            // Gọi hàm generateTodayInfo khi trang tải xong
            window.onload = generateTodayInfo;

            // Hàm để sinh báo cáo cho năm đã nhập
            function generateReport() {
                const year = document.getElementById('yearInput').value;
                document.getElementById('yearDisplay').textContent = year;

                const reportTableBody = document.getElementById('reportTableBody');
                reportTableBody.innerHTML = ''; // Xóa dữ liệu cũ
                const today = new Date();
                //const year = today.getFullYear();
                const month = today.getMonth() + 1;
                const day = today.getDate();
                const solarDateString = `${day}/${month}/${year}`;
                const solarDateParsed = parseDate(solarDateString);
                const lunarDate = convertToLunarDate(solarDateParsed); // Chuyển đổi ngày dương lịch sang âm lịch

                // Hiển thị ngày dương lịch và âm lịch
                document.getElementById("currentSolarDate").textContent = `${day}/${month}/${year}`;
                document.getElementById("currentLunarDate").textContent = `${lunarDate.day}/${lunarDate.month}`;

                // Lấy thông tin lễ và bài đọc
                const chasubleData = calculateChasuble(year); // Gọi hàm calculateChasuble
                const feasts = calculateFeasts(year); // Lấy các ngày lễ
                const feast = getFeastForDay(today, feasts); // Lấy lễ chính
                const secondFeasts = calculateSecondFeasts(year); // Lấy các lễ vọng
                const readingDateString = `${year}-${month}-${day}`;

                let lastWeekNumber = -1; // Để theo dõi tuần

                for (let month = 1; month <= 12; month++) {
                    for (let day = 1; day <= 31; day++) {
                        const solarDateString = `${day}/${month}`;
                        const solarDateParsed = parseDate(`${day}/${month}/${year}`); // Chuyển đổi chuỗi ngày thành đối tượng
                        const solarDate = new Date(solarDateParsed.year, solarDateParsed.month - 1, solarDateParsed.day);

                        if (solarDate.getMonth() + 1 !== month) break; // Đảm bảo không vượt quá số ngày của tháng

                        const lunarDate = convertToLunarDate(solarDateParsed); // Chuyển đổi ngày dương lịch sang âm lịch

                        const chasuble = chasubleData.getChasubleForDay(solarDate); // Lấy màu áo lễ
                        const feast = getFeastForDay(solarDate, feasts); // Lấy ngày lễ nếu có

                        const codeNumber = calculatenumberSunday(year).getCodeNumberForDay(solarDate);

                        // Gọi hàm với các tham số ngày, tháng, năm từ đối tượng solarDateParsed
                        const secondaryCode = getCodeForDate(solarDateParsed.day, solarDateParsed.month, solarDateParsed.year);
                        //console.log ("Code thứ 2:", secondaryCode);
                        
                        const currentWeekNumber = Math.ceil((solarDate.getDate() - solarDate.getDay() + 1) / 7); // Tính số tuần

                        // Thêm ngăn cách giữa các tuần
                        if (currentWeekNumber !== lastWeekNumber && lastWeekNumber !== -1) {
                            const separatorRow = document.createElement('tr');
                            separatorRow.classList.add('week-separator');
                            const separatorCell = document.createElement('td');
                            separatorCell.colSpan = 6; // Số cột trong bảng
                            separatorRow.appendChild(separatorCell);
                            reportTableBody.appendChild(separatorRow);
                        }
                        lastWeekNumber = currentWeekNumber;

                        const row = document.createElement('tr');

                        // Nếu là Chủ Nhật, thêm hiệu ứng 3D
                        if (solarDate.getDay() === 0) {
                            row.classList.add('sunday');
                        }

                        // Gán lớp màu nền cho hàng theo chasuble
                        const chasubleClass = getChasubleClass(chasuble);
                        if (chasubleClass) {
                            row.classList.add(chasubleClass);
                        }

                        // Ngày dương lịch
                        const solarDateCell = document.createElement('td');
                        solarDateCell.textContent = `${day}/${month}/${year}`;
                        row.appendChild(solarDateCell);

                        // Ngày âm lịch
                        const lunarDateCell = document.createElement('td');
                        lunarDateCell.textContent = `${lunarDate.day}/${lunarDate.month}`;
                        row.appendChild(lunarDateCell);

                        // Màu áo lễ
                        const chasubleCell = document.createElement('td');
                        chasubleCell.textContent = chasuble;
                        row.appendChild(chasubleCell);
                        
                        // Ngày lễ chính
                        const feastAndReadingCell = document.createElement('td');
                        let feastAndReadingContent = '';

                        // Nếu có ngày lễ vọng nếu có
                        if (feast) {
                            feastAndReadingContent += formatFeastName(feast.name) + '<br>';
                        }

                        // Thêm bài đọc vào sau phần ngày lễ
                            const readingContent = showfordayContent(solarDate); // Gọi hàm showfordayContent để lấy nội dung bài đọc
                            if (readingContent) {
                                feastAndReadingContent += `<div class="readable" onclick="showReadingContent('${solarDate.toISOString()}')">${readingContent}</div>`;
                            } else {
                                feastAndReadingContent += 'Không có bài đọc';  // Nếu không có bài đọc
                                }
                        
                                const secondFeast = getSecondFeastsForDate(solarDate, secondFeasts);
                                if (secondFeast) {
                                    feastAndReadingContent += '<br>' + formatFeastName(secondFeast.name) + '<br>';
                                }

                           // Thêm bài đọc phụ vào sau phần ngày lễ
                                const reading1 = showOptionContent(solarDate); // Gọi hàm showOptionContent để tên bài đọc

                                if (reading1 && reading1 !== "1") {
                                    // Thay vì hiển thị "Click để xem bài đọc phụ", hiển thị tên bài đọc (reading1)
                                    feastAndReadingContent += `
                                        <div class="readable" onclick="showBibleOptionContent('${solarDate.toISOString()}')">
                                            ${reading1}
                                        </div>
                                    `;
                                } else {
                                    feastAndReadingContent += '';  // Nếu không có bài đọc
                                }


                            feastAndReadingCell.innerHTML = feastAndReadingContent;
                            row.appendChild(feastAndReadingCell);

                            // Thêm NumberCode vào cột mới
                            const numberCodeCell = document.createElement('td');
                            numberCodeCell.textContent = codeNumber;
                            row.appendChild(numberCodeCell);
                            
                            // Thêm secondaryCode vào cột mới
                            const secondaryCodeCell = document.createElement('td');
                            secondaryCodeCell.textContent = secondaryCode; // Giả sử secondaryCode đã được tính toán
                            row.appendChild(secondaryCodeCell);


                        reportTableBody.appendChild(row);
                    }
                }
            }


            // xuống 1.5 hàng khi gặp ký tự trong bài đọc
            function formatWithLineBreaks(text) {
                if (!text) return ''; // Kiểm tra chuỗi trống
                // Sử dụng div với line-height để tạo khoảng cách dòng lớn hơn
                return text.replace(/(\r\n|\n|\r)/g, '<div style="line-height: 2;"></div>'); 
            }

            // Hàm phụ trợ để định dạng từng bài đọc (bài đọc I, II, Tin Mừng)
            function formatReadingPart(title, readingPart) {
                if (!readingPart) return `<strong style="color: red;"> ${title}:</strong> Not available<br><br>`;
                
                return `
            <br><strong style="color: red;">${title}:</strong> ${formatWithLineBreaks(readingPart.excerpt)} <br>
                    <br><em>${formatWithLineBreaks(readingPart.info || '')}</em><br>
                    <br><strong>${formatWithLineBreaks(readingPart.title || '')}</strong><br>
                    <br>${formatWithLineBreaks(readingPart.content || '')}<br>
                    <br><strong>${formatWithLineBreaks(readingPart.end || '')}</strong><br><br>
                `;
            }

            // Hàm phụ trợ để định dạng phần Đáp ca
            function formatPsalms(psalms) {
                if (!psalms) return '<strong>Đáp ca:</strong> Not available<br><br>';
                
                return `
                    <strong style="color: red;"> Đáp ca:</strong> ${formatWithLineBreaks(psalms.excerpt)} <br>
                    <br><strong>${formatWithLineBreaks(psalms.response)}</strong><br>
                    <br><em>${psalms.verses.map(formatWithLineBreaks).join('<br><br>')}</em><br><br>
                `;
            }

            // Hàm phụ trợ để định dạng phần Xướng trước Tin Mừng
            function formatAlleluia(alleluia) {
                if (!alleluia) return '<strong style="color: red;">Xướng trước Tin Mừng:</strong> Not available<br><br>';
                
                return `
                    <strong style="color: red;"> Xướng trước Tin Mừng:</strong> ${formatWithLineBreaks(alleluia.verse)} <br>
                    <br><strong>${formatWithLineBreaks(alleluia.content)}</strong><br><br>
                `;
            }

           // Hàm hiển thị nội dung bài đọc chính
            function showReadingContent(dateString) {
                const date = new Date(dateString);  // Chuyển đổi chuỗi thành đối tượng Date
                const reading = getBibleByFourDigitCode(date);  // Lấy bài đọc
                const year = date.getFullYear();
                const feasts = calculateFeasts(year); // Lấy danh sách lễ
                updateModalTitle(date, feasts); // Cập nhật tiêu đề modal
                if (reading) {
                    // Biến lưu trữ nội dung bài đọc với các điều kiện kiểm tra từng phần
                    const readingContent = `
                        ${formatReadingPart('Bài Đọc I', reading.firstReading)}
                        ${formatPsalms(reading.psalms)}
                        ${reading.secondReading ? formatReadingPart('Bài Đọc II', reading.secondReading) : ''} 
                        ${formatAlleluia(reading.alleluia)}
                        ${formatReadingPart('Tin Mừng', reading.gospel)}
                   `;

                    // Hiển thị nội dung bài đọc trong phần tử HTML có ID là "readingContent"
                    document.getElementById("readingContent").innerHTML = readingContent;
                } else {
                    // Không có bài đọc, hiển thị thông báo
                    document.getElementById("readingContent").innerHTML = "Không có bài đọc.";
                }

                // Hiển thị modal và overlay
                document.getElementById("readingModal").style.display = "block"; 
                document.getElementById("modalOverlay").style.display = "block"; 

            }

            // Hàm hiển thị nội dung bài đọc phụ
            function showBibleOptionContent(dateString) {
                const date = new Date(dateString);
                const reading = getBibleByOptionDigitCode(date);  // Lấy bài đọc
                const year = date.getFullYear();
                const feasts = calculateFeasts(year); // Lấy danh sách lễ
                updateModalTitle1(date, feasts); // Cập nhật tiêu đề modal

                if (reading) {
                    // Biến lưu trữ nội dung bài đọc với các điều kiện kiểm tra từng phần
                    const readingContent = `
                        ${formatReadingPart('Bài Đọc I', reading.firstReading)}
                        ${formatPsalms(reading.psalms)}
                        ${reading.secondReading ? formatReadingPart('Bài Đọc II', reading.secondReading) : ''} 
                        ${formatAlleluia(reading.alleluia)}
                        ${formatReadingPart('Tin Mừng', reading.gospel)}
                   `;

                    // Hiển thị nội dung bài đọc trong phần tử HTML có ID là "readingContent"
                    document.getElementById("readingContent").innerHTML = readingContent;
                } else {
                    return "1";
                }

                // Hiển thị modal và overlay
                document.getElementById("readingModal").style.display = "block"; 
                document.getElementById("modalOverlay").style.display = "block"; 

            }

            // Hàm hiển thị tên bài đọc chính
            function showfordayContent(date) {
            const reading = getBibleByFourDigitCode(date); // Gọi hàm để lấy bài đọc
            if (reading) {
            // Loại bỏ (Năm I) hoặc (Năm II) bất kể chữ hoa hay chữ thường
            const reading1 = reading.firstReading ? `${reading.firstReading.excerpt.replace(/\(năm i\)|\(năm ii\)/gi, '').trim()}; ` : 'Không có Bài Đọc I';
                const psalm = reading.psalms ? `${reading.psalms.excerpt}; ` : 'Không có Thánh Vịnh';
                const reading2 = reading.secondReading ? `${reading.secondReading.excerpt}; ` : '';
                const gospel = reading.gospel ? `${reading.gospel.excerpt}` : 'Không có Tin Mừng';

                // Kết hợp tất cả các phần vào một chuỗi
                const readingContent = `${reading1}${psalm}${reading2}${gospel}`;
                return readingContent;
            } else {
                return 'Không có bài đọc'; // Trả về chuỗi thông báo
            }
            }


            // Hàm hiển thị tên bài đọc phụ
          function showOptionContent(date) {
                const reading = getBibleByOptionDigitCode(date); // tại sao báo lỗi hàm chưa được định nghĩa???
               if (reading) {
                    const reading1 = reading.firstReading ? `${reading.firstReading.excerpt}; ` : 'Không có Bài Đọc I';
                    const psalm = reading.psalms ? `${reading.psalms.excerpt}; ` : 'Không có Thánh Vịnh';
                    const reading2 = reading.secondReading ? `${reading.secondReading.excerpt}; ` : '';
                    const gospel = reading.gospel ? `${reading.gospel.excerpt}` : '';

                    // Kết hợp tất cả các phần vào một chuỗi
                    const readingContent = `${reading1}${psalm}${reading2}${gospel}`;
                     return readingContent;
                } else {
                    return '';
                }
            }
   
            function openModal() {
                document.getElementById("readingModal").style.display = "block";
            }

            // Hàm đóng modal
            function closeModal() {
                document.getElementById("readingModal").style.display = "none";
                document.getElementById("modalOverlay").style.display = "none";
            }

            // Thêm sự kiện cho nút "X" đóng modal
            document.querySelector('.close').onclick = function() {
                closeModal();
            }

            // Hàm định dạng tên lễ theo yêu cầu
            function formatFeastName(feastName) {
                if (feastName.includes("Lễ nhớ")) {
                    const feastParts = feastName.split('.');
                    if (feastParts.length > 1) {
                        const firstPart = feastParts[0] + '.';
                        const secondPart = feastParts.slice(1).join('.');
                        return `${firstPart} <span class="feast-bold">${secondPart}</span>`;
                    } else {
                        return feastName;
                    }
                    } else if (feastName.includes("Lễ kính")) {
                        return feastName.replace("Lễ kính", `<span class="feast-bold">Lễ kính</span>`);
                    } else if (feastName.includes("CHÚA NHẬT")) {
                        const feastParts = feastName.split('.');
                        if (feastParts.length > 1) {
                            const firstPart = feastParts[0] + '.';
                            const secondPart = feastParts.slice(1).join('.');
                            return `<span class="feast-bold"> ${firstPart}</span> ${secondPart}`;
                        }
                    } else if (feastName.includes("Lễ trọng")) {
                        return `<span class="feast-bold">${feastName}</span>`;
                }
                return feastName;
            }

            // Hàm chuyển đổi màu Chasuble thành lớp CSS cho màu nền
            function getChasubleClass(chasuble) {
                switch (chasuble) {
                    case 'Tr': return 'bg-Tr'; // Màu trắng
                    case 'Tm': return 'bg-Tm'; // Màu tím
                    case 'Đ': return 'bg-Đ';   // Đỏ nhẹ
                    case 'X': return 'bg-X';   // Xanh lá cây
                    default: return '';        // Không có màu
                }
            }
            // Hàm cập nhật thông tin ngày tháng và tên lễ trong modal
            function updateModalTitle(date, feasts) {
                const day = date.getDate();
                const month = date.getMonth() + 1; // Tháng trong JavaScript bắt đầu từ 0
                const year = date.getFullYear();

                // Lấy tên lễ từ danh sách feasts cho ngày hiện tại
                const feast = getFeastForDay(date, feasts);
                const feastName = feast ? feast.name : 'Không có lễ đặc biệt';

                // Cập nhật thẻ <h3> trong modal
                document.querySelector("#readingModal h3").textContent = `Bài Đọc Ngày: ${day}/${month}/${year} - ${feastName}`;
            }
            function updateModalTitle1(date, secondFeasts, feasts) {
    const day = date.getDate();
    const month = date.getMonth() + 1; // Tháng trong JavaScript bắt đầu từ 0
    const year = date.getFullYear();

    // Lấy các lễ vọng
    const secondFeast1 = calculateSecondFeasts(year); 

    // Lấy lễ vọng từ danh sách secondFeasts cho ngày hiện tại
    const secondFeast = getSecondFeastsForDate(date, secondFeast1);
    console.log('Lễ vọng:', secondFeast); // In ra kiểm tra xem có lấy được lễ vọng không

    // Nếu có lễ vọng, lấy tên lễ vọng; nếu không, hiển thị lễ chính
    let feastName;
    if (secondFeast && secondFeast.name) {
        feastName = secondFeast.name; // Lấy tên lễ vọng
    } else {
        const feasts = calculateFeasts(year);
        const feast = getFeastForDay(date, feasts); // Lấy lễ chính nếu không có lễ vọng
        feastName = feast ? feast.name : 'Không có lễ đặc biệt';
        feastName = feastName.replace(/Thứ Hai\.|Thứ Ba\.|Thứ Tư\.|Thứ Năm\.|Thứ Sáu\.|Thứ Bảy\./g, '').trim();

        // Thêm chuỗi "Về vị thánh" vào trước tên lễ chính
        feastName = "Về Lễ " + feastName;
    }

    // Cập nhật thẻ <h3> trong modal
    document.querySelector("#readingModal h3").textContent = `Bài Đọc Ngày: ${day}/${month}/${year} - ${feastName}`;
}




            // Hàm chuyển chuỗi ngày thành đối tượng ngày
            function parseDate(dateString) {
                const [day, month, year] = dateString.split('/').map(Number);
                return { day, month, year };
            }   

            // Hàm chuyển đổi ngày dương lịch sang ngày âm lịch
            function convertToLunarDate({ day, month, year }) {
                const lunarDate = getLunarDate(day, month, year);
                return lunarDate ? { day: lunarDate.day, month: lunarDate.month, year: lunarDate.year } : { day: '', month: '' };
            }

            // Hàm lấy thông tin ngày lễ từ danh sách feasts
            function getFeastForDay(solarDate, feasts) {
            for (let feast of feasts) {
                    if (feast.date && solarDate.getDate() === feast.date.getDate() &&
                        solarDate.getMonth() === feast.date.getMonth() &&
                        solarDate.getFullYear() === feast.date.getFullYear()) {
                        return feast;
                    }
                }
                return null;
                }
function getSecondFeastsForDate(date, secondFeasts) {
    for (let secondFeast of secondFeasts) {
        if (secondFeast.date &&
            date.getDate() === secondFeast.date.getDate() &&
            date.getMonth() === secondFeast.date.getMonth() &&
            date.getFullYear() === secondFeast.date.getFullYear()) {
            return secondFeast; // Trả về lễ vọng nếu ngày khớp
        }
    }
    return null; // Trả về null nếu không có lễ vọng
}

       </script>

    </body>
</html>
