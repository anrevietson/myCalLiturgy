<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lịch Công Giáo</title>
   <style>
    /* Phong cách chung cho toàn trang */
    body {
    font-family: Arial, sans-serif;
    background-color: #f5f5f5;
    margin: 0;
    padding: 0;
    color: #333;
}

/* Header */
.calendar-header {
    background-color: #007bff;
    color: white;
    padding: 15px;
    text-align: center;
    font-size: 24px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

/* Container chính */
.calendar-content {
    background-color: white;
    border-radius: 15px;
    margin: 20px auto;
    padding: 20px;
    max-width: 900px;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
    text-align: center;
}

/* Định dạng phần ngày lớn và ngày nhỏ */
.reading-row {
    display: flex;
    justify-content: space-between; /* Căn đều các phần tử */
    align-items: center; /* Căn giữa theo chiều dọc */
    gap: 15px; /* Khoảng cách giữa các phần tử */
    padding: 10px 0;
}

.date-large {
    font-size: 150px;
    color: red;
    text-align: center;
    margin: -5px; /* Đảm bảo margin có đơn vị */
    line-height: 0.9;
    font-weight: bold;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

.weekday {
    margin-left: 100px;
    font-size: 20px;
    font-weight: bold;
    color: #2196F3;
}

.lunar-date {
    margin-right: 100px;
    font-size: 20px;
    font-weight: normal;
    color: #ff0000;
}

.date-small {
    font-size: 18px;
    color: #3506f0;
    margin: 0;
    font-weight: bold;
}

/* Căn chỉnh thông tin lễ và bài đọc */
.feast-info-container {
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
    gap: 15px;
    margin-top: 15px;
}

.feast-info {
    font-size: 18px;
    margin: 0;
}

/* Định dạng phần bài đọc */
.readings {
    margin: 10px 0;
    text-align: center;
    font-size: 16px;
    line-height: 1.5;
}

.readings div {
    margin-bottom: 8px;
}

/* Footer */
.bottom-nav {
    display: flex;
    justify-content: space-around;
    background-color: #007bff;
    color: white;
    padding: 15px;
    position: fixed;
    width: 100%;
    bottom: 0;
    box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
}

.bottom-nav div {
    text-align: center;
    cursor: pointer;
}

.bottom-nav div:hover {
    background-color: #0056b3;
}

/* Bảng hiển thị thông tin */
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 30px;
}

table, th, td {
    border: 1px solid black;
}

th, td {
    padding: 10px;
    text-align: center;
}

th {
    background-color: #f2f2f2;
    font-weight: bold;
}

/* Màu nền theo màu áo lễ */
.bg-Tr { background-color: white; }
.bg-Tm { background-color: #d8bfd8; }
.bg-Đ { background-color: #ff6347; }
.bg-X { background-color: lightgreen; }

.week-separator {
    height: 1px;
    border-top: 10px solid #ccc;
}

.image-container {
    text-align: center;
    margin-bottom: 0px;
}

.image-container img {
    width: 130px;
    height: 130px;
    border-radius: 50%;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
}

/* Định dạng văn bản đặc biệt */
.info {
    color: #020e5f;
    font-weight: bold;
    font-style: italic;
    background-color: #94faf3;
    padding: 10px;
    border-radius: 5px;
}

/* Modal (hộp thoại) */
.modal {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1000;
    background-color: #f5f7b3;
    padding: 30px;
    box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.3);
    width: 80%;
    max-width: 700px;
    max-height: 80%;
    overflow-y: auto;
    border-radius: 10px;
}

.modal-content {
    padding: 20px;
    text-align: left;
}

.close:focus {
    color: #000;
    text-decoration: none;
    cursor: pointer;
}

/* Overlay (nền mờ) */
.overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    z-index: 999;
}

/* Hiển thị modal và overlay */
.modal.show, .overlay.show {
    display: block;
}

/* Căn chỉnh các nút cố định bên trái màn hình */
.vertical-buttons {
    position: sticky;
    top: 10px;
    left: 5px;
    display: flex;
    flex-direction: row;
    gap: 10px;
    z-index: 1001;
}

.icon-button {
    background-color: transparent;
    border: none;
    cursor: pointer;
    padding: 10px;
    font-size: 24px;
    font-weight: bold;
    color: #d18a78;
    border-radius: 50%;
    transition: background-color 0.3s ease;
}

.icon-button:hover {
    background-color: #f5ead6;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
}

br {
    line-height: 2;
}

.readable {
    cursor: pointer;
    transition: color 0.3s ease;
}

.readable:hover {
    color: blue;
    font-weight: bold;
}

/* Định dạng cho các tên lễ */
.feast-bold {
    font-weight: bold;
}

/* Media Queries cho thiết bị di động */
@media (max-width: 768px) {
    .calendar-content {
        padding: 10px;
        margin: 10px;
    }

    .controls-container {
        flex-direction: column;
        align-items: flex-start;
    }

    input[type="date"], input[type="number"], select, button {
        width: 100%; /* Đảm bảo chiều rộng đầy đủ trên màn hình nhỏ */
        margin-bottom: 10px;
    }
}

/* Container chung cho phần chọn ngày và các nút */
.controls-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 10px; /* Khoảng cách giữa các phần tử */
    padding: 10px;
    flex-wrap: nowrap; /* Không cho các phần tử xuống hàng */
}

.control-item {
    flex: none; /* Đảm bảo các phần tử không giãn ra */
    min-width: auto; /* Đảm bảo chiều rộng tự động */
}

input[type="date"], input[type="number"], select, button {
    padding: 8px;
    font-size: 16px;
    border-radius: 5px;
    border: 1px solid #ccc;
    width: auto; /* Đảm bảo không chiếm toàn bộ chiều rộng */
}

button {
    background-color: #007BFF;
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 4px;
    font-size: 16px;
}

button:hover {
    background-color: #0056b3;
}

/* Định dạng lại cho các màn hình nhỏ */
@media (max-width: 768px) {
    .controls-container {
        flex-wrap: wrap; /* Cho phép các phần tử xuống hàng trên màn hình nhỏ */
    }

    input[type="date"], input[type="number"], select, button {
        width: 100%; /* Đảm bảo chiều rộng đầy đủ trên màn hình nhỏ */
        margin-bottom: 10px;
    }
}




</style>

<!-- Tích hợp các tệp JS -->
<script src="js/saintcelebration.js"></script> 
    <script src="js/calculateLunarSolar.js"></script> 
    <script src="js/calculateChasuble.js"></script> 
    <script src="js/calculateFeasts.js"></script> 
    <script src="js/calculateBasic.js"></script> 
    <script src="js/calculatenumberSunday.js"></script> 
    <script src="js/calculatenumberSecondary.js"></script>   
    <script src="js/calculateReading.js"></script>
    <script src="Reading/Sunday.js"></script> 
    <script src="js/calculatebibleReads.js"></script>
    <script src="Reading/DailySeason.js"></script>
    <script src="Reading/DailyOrdinary1.js"></script>
    <script src="Reading/DailyOrdinary2.js"></script>
    <script src="Reading/SaintsBible.js"></script>
    <script src="Reading/Optionsaint.js"></script>
    <script src="js/secondfeast.js"></script> <!-- Thêm secondfeast.js vào -->
    <script src="js/calculateOptionbibleReads.js"></script> 

<body>

  <!-- Phần Header -->
  <header>
    LỊCH PHỤNG VỤ CÔNG GIÁO
</header>


<div id="readingModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span> <!-- Thêm dấu "X" đóng modal -->
        <h3>Bài Đọc Ngày Lễ</h3>
          <!-- Nút cố định dọc bên trái trong modal -->
           <div class="vertical-buttons">
            <button class="icon-button" onclick="increaseFontSize()">+</button>
            <button class="icon-button" onclick="decreaseFontSize()">-</button>
            <button class="icon-button" onclick="quitModal()">Close</button> <!-- Nút Quit -->
            <button class="icon-button" onclick="boldText()">B</button> <!-- Nút Bold -->
        </div>
        <div id="readingContent"></div>
    </div>
</div>



<div id="modalOverlay" class="overlay" onclick="closeModal()"></div>

<!-- Hiển thị thông tin ngày hôm nay hoặc ngày đã chọn -->

<div class="calendar-content">
        <!-- Nội dung của một trang lịch -->
        <div class="image-container">
            <img src="01.webp" alt="Maria và Chúa Giêsu">
        </div>

    <!-- Thông tin lễ và Lễ Phục cùng nằm trên một hàng và được căn giữa -->
<div class="details" id="detailsSection">
                <div class="feast-info-container">
                    <p class="feast-info" id="feast-info"></p> <!-- Thông tin lễ -->
                </div>
                <p class="readings">
                    <span id="reading1"></span> <span id="psalm"></span>
                    <span id="reading2"></span> <span id="gospel"></span>
                </p>
                <p class="info">
                    <span id="info"></span>
                </p>
                <!-- Hiển thị lễ vọng -->
                <div>
                    <p id="second-feast-info"></p>
                </div>
                <!-- Hiển thị bài đọc phụ -->
                <div>
                    <p id="optional-reading"></p>
                    <div class="reading-row">
                        <div class="weekday" id="weekday">THỨ HAI</div>
                        <p class="date-large" id="current-date">1</p>
                        <div class="lunar-date" id="lunarDate">AL: 1/2</div>
                    </div>
                    
                <p class="date-small" id="current-month-year"></p>
               



<!-- Chọn ngày và các nút Lịch -->
<div class="controls-container">
    <!-- Chọn ngày -->
    <div class="control-item">
        <label for="inputDate"></label>
        <input type="date" id="inputDate" onchange="getFeastForSelectedDate()"> <!-- Gọi hàm khi người dùng chọn ngày -->
        <button onclick="displayWeekInfo()">Lịch Tuần</button>
        <!-- Chọn tháng và năm để hiển thị lịch -->

</div>
    <label for="monthInput"></label>
    <select id="monthInput">
        <option value="1">Tháng 1</option>
        <option value="2">Tháng 2</option>
        <option value="3">Tháng 3</option>
        <option value="4">Tháng 4</option>
        <option value="5">Tháng 5</option>
        <option value="6">Tháng 6</option>
        <option value="7">Tháng 7</option>
        <option value="8">Tháng 8</option>
        <option value="9">Tháng 9</option>
        <option value="10">Tháng 10</option>
        <option value="11">Tháng 11</option>
        <option value="12">Tháng 12</option>
    </select>

    <label for="yearInput"></label>
    <input type="number" id="yearInput" value="2024">

    <button onclick="displayMonthInfo()">Xem lịch tháng</button>

 </div>
 

<h2>Lịch Phụng vụ <span id="yearDisplay"></span></h2>

<!-- Bảng hiển thị thông tin -->
<table>
    <thead>
        <tr>
            <th>Ngày</th>
            <!--<th>Ngày (Âm lịch)</th>-->
            <th>Màu</th>
            <th>Thông tin Ngày Lễ và Bài Đọc</th>
        </tr>
    </thead>
    <tbody id="reportTableBody">
        <!-- Nội dung sẽ được chèn vào đây -->
    </tbody>
</table>

</body>
</html>

<script>

function getWeekday(date) {
        const days = ["CHÚA NHẬT", "THỨ HAI", "THỨ BA", "THỨ TƯ", "THỨ NĂM", "THỨ SÁU", "THỨ BẢY"];
        return days[date.getDay()];
    }

    function getMonthName(date) {
        const months = [
            "THÁNG MỘT", "THÁNG HAI", "THÁNG BA", "THÁNG TƯ", "THÁNG NĂM", "THÁNG SÁU",
            "THÁNG BẢY", "THÁNG TÁM", "THÁNG CHÍN", "THÁNG MƯỜI", "THÁNG MƯỜI MỘT", "THÁNG MƯỜI HAI"
        ];
        return months[date.getMonth()];
}
// làm sao tôi cập nhật getWeekday(date) và getMonthName(date) vào hàm sau

function displayDateInfo(date) {
    const selectedDate = date ? new Date(date) : new Date(); // Sử dụng ngày đã chọn hoặc ngày hiện tại
    const year = selectedDate.getFullYear();
    const month = selectedDate.getMonth() + 1;
    const day = selectedDate.getDate();

// Sử dụng các hàm getWeekday và getMonthName để lấy thứ và tháng
const weekday = getWeekday(selectedDate);  // Lấy thứ trong tuần
const monthName = getMonthName(selectedDate);  // Lấy tên tháng

// Lấy ngày Chúa Nhật đầu tiên của Mùa Vọng trong năm hiện tại
const firstSundayOfAdvent = getFirstSundayOfAdvent(year);

// Kiểm tra xem ngày hiện tại có sau Chúa Nhật đầu tiên của Mùa Vọng không
let liturgicalYear = getLiturgicalYear(year);
if (selectedDate >= firstSundayOfAdvent) {
    // Nếu sau Chúa Nhật đầu tiên của Mùa Vọng, cộng thêm 1 cho năm phụng vụ
    liturgicalYear = getLiturgicalYear(year + 1);
}

// Hiển thị thứ trong tuần, ngày và tháng/năm phụng vụ
document.getElementById("weekday").textContent = weekday; // Hiển thị thứ trong tuần
document.getElementById("current-date").textContent = day; // Hiển thị ngày
document.getElementById("current-month-year").textContent = `${monthName} - ${year} NĂM ${liturgicalYear}`; // Hiển thị tháng/năm và năm phụng vụ

    // Chuyển đổi ngày âm lịch
    const lunarDate = convertToLunarDate({ day, month, year });

    // Lấy can chi sau khi có ngày âm lịch
    const lunarNewYearArray = getSolarDate(lunarDate.day, lunarDate.month, year); // Lấy mảng trả về (ngày, tháng)
    const lunarNewYear = new Date(year, lunarNewYearArray[1] - 1, lunarNewYearArray[0]); // Sử dụng ngày và tháng từ mảng, thêm năm
    const canChi = getYearCanChi(lunarNewYear.getFullYear()); // Tính can chi của năm âm lịch

    // Hiển thị ngày âm lịch (AL) và can chi trong phần tử `lunarDate`

    document.getElementById("lunarDate").innerHTML = `AL: ${lunarDate.day}/${lunarDate.month}<br>${canChi}`;


    // Lấy thông tin lễ và bài đọc
    const feasts = calculateFeasts(year);
    const secondFeasts = calculateSecondFeasts(year); // Lấy các lễ vọng
    const feast = getFeastForDay(selectedDate, feasts);
    document.getElementById("feast-info").innerHTML = feast ? formatFeastName(feast.name) : 'Không có lễ đặc biệt';

    const readingContent = showfordayContent(selectedDate)?.split('; ') || [];
    const info = showfordayContentinfo(selectedDate);

    const solarDate = selectedDate.toISOString();

    // Hiển thị thông tin bài đọc
    updateReadingInfo(info, readingContent, solarDate);

    // Tính toán và thêm lễ vọng (second feast)
    const secondFeast = getSecondFeastsForDate(selectedDate, secondFeasts); // Trả về một đối tượng hoặc null
    document.getElementById("second-feast-info").innerHTML = secondFeast
        ? formatFeastName(secondFeast.name)
        : '';

   // Lấy thông tin bài đọc phụ và cập nhật chỉ khi có giá trị
   const reading1 = showOptionContent(selectedDate);
    if (reading1 && reading1.trim() !== "") {
        updateOptionalReadingInfo(reading1, secondFeast);
    } else {
        document.getElementById("optional-reading").textContent = ''; // Xóa thông tin bài đọc phụ nếu không có giá trị
    }
}




function updateOptionalReadingInfo(reading1, solarDate) {

    // Kiểm tra nếu bài đọc phụ tồn tại và khác "1"
    if (reading1 && reading1 !== "1") {

        // Xác định phần tử HTML cho bài đọc phụ
        const optionalReadingContainer = document.getElementById("optional-reading");
        if (!optionalReadingContainer) {
            return;
        }
        // Cập nhật nội dung bài đọc phụ
        optionalReadingContainer.innerHTML = `
            <div class="readable" id="optional-content">
                <strong>${reading1 || ''}</strong>
            </div>`;

        // Gán sự kiện onclick cho phần tử vừa tạo
        const optionalContent = document.getElementById("optional-content");
        if (optionalContent) {
            optionalContent.addEventListener('click', function() {
                try {
                    // Lấy thuộc tính `date` từ `solarDate` và chuyển thành chuỗi
                    const dateStr = solarDate.date.toISOString();
                    showBibleOptionContent(dateStr); // Truyền chuỗi định dạng ngày
                } catch (error) {
                }  
            });
        }

        // Nếu reading1 là mảng, xử lý hiển thị thêm nội dung bài đọc
        if (Array.isArray(reading1)) {
            const reading1Container = document.getElementById("reading1");
            if (!reading1Container) {
                return;
            }

            if (reading1.length === 4) {
                console.log("Bài đọc có độ dài 4:", reading1);
                reading1Container.innerHTML = `
                    <div class="readable" id="reading1-content">
                        <strong>${reading1[0] || ''}</strong> ${reading1[1] || ''} 
                        ${reading1[2] || ''}<strong> ${reading1[3] || ''}
                    </div>`;
                const reading1Content = document.getElementById("reading1-content");
                if (reading1Content) {
                    reading1Content.addEventListener('click', function() {
                        try {
                            const dateStr = solarDate.date.toISOString(); // Chuyển ngày thành chuỗi
                            showReadingContent(dateStr); // Truyền chuỗi định dạng ngày
                        } catch (error) {
                        }
                    });
                }
            } else if (reading1.length === 3) {
                reading1Container.innerHTML = `
                    <div class="readable" id="reading1-content">
                        <strong>${reading1[0] || ''}</strong> ${reading1[1] || ''} 
                        <strong>${reading1[2] || ''}
                    </div>`;
                const reading1Content = document.getElementById("reading1-content");
                if (reading1Content) {
                    reading1Content.addEventListener('click', function() {
                        try {
                            const dateStr = solarDate.date.toISOString(); // Chuyển ngày thành chuỗi
                            showReadingContent(dateStr); // Truyền chuỗi định dạng ngày
                        } catch (error) {
                        }
                    });
                }
            }
        }
    } 
}



// Hàm để cập nhật thông tin bài đọc 
function updateReadingInfo(info, readingContent, solarDate) {
    if (readingContent.length === 4) {
        document.getElementById("info").innerHTML = `<strong><em>${info}</em></strong>`;
        document.getElementById("reading1").innerHTML = `
            <div class="readable" onclick="showReadingContent('${solarDate}')">
                <strong>${readingContent[0] || ''}</strong> ${readingContent[1] || ''} 
                ${readingContent[2] || ''}<strong> ${readingContent[3] || ''}
            </div>`;
    } else if (readingContent.length === 3) {
        document.getElementById("info").innerHTML = `<strong><em>${info}</em></strong>`;
        document.getElementById("reading1").innerHTML = `
            <div class="readable" onclick="showReadingContent('${solarDate}')">
                <strong>${readingContent[0] || ''}</strong> ${readingContent[1] || ''} 
                <strong>${readingContent[2] || ''}
            </div>`;
    }
}


// Khi trang được tải, hiển thị thông tin ngày hôm nay
window.onload = function() {
    displayDateInfo();
};


// Hàm cập nhật thông tin khi chọn ngày từ input
function getFeastForSelectedDate() {
    const inputDate = document.getElementById('inputDate').value;
    if (!inputDate) {
        alert('Vui lòng chọn một ngày.');
        return;
    }
    displayDateInfo(inputDate); // Cập nhật thông tin dựa trên ngày đã chọn
}

// Hiển thị tuần phụng vụ
function displayWeekInfo() {
    const today = new Date();
    const startOfWeek = new Date(today.setDate(today.getDate() - today.getDay())); // Chủ Nhật đầu tuần
    const endOfWeek = new Date(startOfWeek);
    endOfWeek.setDate(startOfWeek.getDate() + 6); // Kết thúc vào Thứ Bảy

    const year = startOfWeek.getFullYear();
    const feasts = calculateFeasts(year); // Lấy các lễ trong năm
    const secondFeasts = calculateSecondFeasts(year); // Lấy các lễ vọng

    // Cập nhật hiển thị thông tin tuần
    const yearDisplayElement = document.getElementById('yearDisplay');
    const startDateString = `${startOfWeek.getDate()}/${startOfWeek.getMonth() + 1}/${startOfWeek.getFullYear()}`;
    const endDateString = `${endOfWeek.getDate()}/${endOfWeek.getMonth() + 1}/${endOfWeek.getFullYear()}`;
    yearDisplayElement.textContent = `từ ngày ${startDateString} đến ${endDateString}`;

    const reportTableBody = document.getElementById('reportTableBody');
    reportTableBody.innerHTML = ''; // Xóa dữ liệu cũ trong bảng

    let currentDay = new Date(startOfWeek); // Bắt đầu từ Chủ Nhật

    // Hiển thị thông tin cho từng ngày trong tuần
    for (let i = 0; i < 7; i++) {
        const year = currentDay.getFullYear();
        const month = currentDay.getMonth() + 1;
        const day = currentDay.getDate();

        // Lấy thông tin lễ, màu áo lễ và bài đọc cho ngày hiện tại
        let feastAndReadingContent = '';
        const feast = getFeastForDay(currentDay, feasts);
        const chasuble = calculateChasuble(year).getChasubleForDay(currentDay);

        // Thêm thông tin về ngày lễ chính
        if (feast) {
            feastAndReadingContent += formatFeastName(feast.name) + '<br>';
        } else {
            feastAndReadingContent += 'Không có lễ đặc biệt<br>';
        }

        // Thêm bài đọc vào sau thông tin lễ
        const readingContent = showfordayContent(currentDay); // Gọi hàm showfordayContent để lấy nội dung bài đọc
            if (readingContent) {
                feastAndReadingContent += `<div class="readable" onclick="showReadingContent('${currentDay.toISOString()}')">${readingContent}</div>`;
            } else {
                feastAndReadingContent += 'Không có bài đọc';  // Nếu không có bài đọc
                }
        
            // Tính toán và thêm lễ vọng (second feast)
            const secondFeast = getSecondFeastsForDate(currentDay, secondFeasts);
                if (secondFeast) {
                feastAndReadingContent += '<br>' + formatFeastName(secondFeast.name) + '<br>';
                }

            // Thêm bài đọc phụ vào sau phần ngày lễ
                const reading1 = showOptionContent(currentDay); // Gọi hàm showOptionContent để tên bài đọc

                if (reading1 && reading1 !== "1") {
                    // Thay vì hiển thị "Click để xem bài đọc phụ", hiển thị tên bài đọc (reading1)
                    feastAndReadingContent += `
                        <div class="readable" onclick="showBibleOptionContent('${currentDay.toISOString()}')">
                            ${reading1}
                        </div>
                    `;
                } else {
                    feastAndReadingContent += '';  // Nếu không có bài đọc
                } 

        // Tạo hàng mới trong bảng
        const row = document.createElement('tr');

        // Nếu là Chủ Nhật, thêm hiệu ứng 3D
        if (currentDay.getDay() === 0) {
            row.classList.add('sunday');
        }

        // Gán lớp màu nền cho hàng theo chasuble
        const chasubleClass = getChasubleClass(chasuble);
        if (chasubleClass) {
            row.classList.add(chasubleClass);
        }

        // Ngày dương lịch và âm lịch được hiển thị trong cùng một ô
        const solarDateCell = document.createElement('td');
        const lunarDate = convertToLunarDate({ day, month, year });

        // Hiển thị ngày dương lịch với chữ đậm và ngày âm lịch với màu xanh đậm
        solarDateCell.innerHTML = `<strong>${day}/${month}</strong><br><em><span style="color: darkblue;">(${lunarDate.day}/${lunarDate.month})</span><em>`;
        row.appendChild(solarDateCell);


         //Màu áo lễ
        const chasubleCell = document.createElement('td');
        chasubleCell.textContent = chasuble || 'Xanh';
        row.appendChild(chasubleCell);

         //Thông tin lễ và bài đọc
        const feastAndReadingCell = document.createElement('td');
        feastAndReadingCell.innerHTML = feastAndReadingContent;
        row.appendChild(feastAndReadingCell);


        reportTableBody.appendChild(row);
    


        // Chuyển sang ngày tiếp theo
        currentDay.setDate(currentDay.getDate() + 1);
    }
}


function displayMonthInfo() {
    // Lấy tháng và năm từ input của người dùng
    const month = parseInt(document.getElementById('monthInput').value);
    const year = parseInt(document.getElementById('yearInput').value);

    // Tính số ngày trong tháng được chọn
    const daysInMonth = new Date(year, month, 0).getDate();

    // Lấy các lễ trong năm
    const feasts = calculateFeasts(year);
    const secondFeasts = calculateSecondFeasts(year); // Lấy các lễ vọng (nếu có)

    // Cập nhật nội dung của thẻ <span id="yearDisplay"> để hiển thị tháng/năm
    const yearDisplayElement = document.getElementById('yearDisplay');
    yearDisplayElement.textContent = `Tháng ${month} - Năm ${year}`;

    // Lấy phần body của bảng để thêm nội dung vào
    const reportTableBody = document.getElementById('reportTableBody');
    reportTableBody.innerHTML = ''; // Xóa dữ liệu cũ trong bảng

    // Biến để lưu số tuần hiện tại
    let lastWeekNumber = -1;

    // Lặp qua từng ngày trong tháng
    for (let day = 1; day <= daysInMonth; day++) {
        const currentDate = new Date(year, month - 1, day);
        const currentWeekNumber = Math.ceil((day - currentDate.getDay() + 1) / 7); // Số tuần trong tháng

        // Thêm ngăn cách giữa các tuần nếu số tuần thay đổi
        if (currentWeekNumber !== lastWeekNumber && lastWeekNumber !== -1) {
            const separatorRow = document.createElement('tr');
            separatorRow.classList.add('week-separator');
            const separatorCell = document.createElement('td');
            separatorCell.colSpan = 4; // Số cột trong bảng
            separatorRow.appendChild(separatorCell);
            reportTableBody.appendChild(separatorRow);
        }
        lastWeekNumber = currentWeekNumber;

        // Tạo hàng mới trong bảng cho mỗi ngày
        const row = document.createElement('tr');

        // Lấy thông tin lễ, màu áo lễ và bài đọc cho ngày hiện tại
        let feastAndReadingContent = '';
        const feast = getFeastForDay(currentDate, feasts); // Lấy thông tin lễ
        const chasuble = calculateChasuble(year).getChasubleForDay(currentDate); // Lấy màu áo lễ

        // Thêm thông tin về ngày lễ chính
        if (feast) {
            feastAndReadingContent += formatFeastName(feast.name) + '<br>';
        } else {
            feastAndReadingContent += 'Không có lễ đặc biệt<br>';
        }

        // Thêm bài đọc vào sau thông tin lễ
        const readingContent = showfordayContent(currentDate); // Gọi hàm showfordayContent để lấy nội dung bài đọc
        if (readingContent) {
            feastAndReadingContent += `<div class="readable" onclick="showReadingContent('${currentDate.toISOString()}')">${readingContent}</div>`;
        } else {
            feastAndReadingContent += 'Không có bài đọc';  // Nếu không có bài đọc
        }

        // Tính toán và thêm lễ vọng (second feast)
        const secondFeast = getSecondFeastsForDate(currentDate, secondFeasts);
        if (secondFeast) {
            feastAndReadingContent += '<br>' + formatFeastName(secondFeast.name) + '<br>';
        }

        // Thêm bài đọc phụ vào sau phần ngày lễ
        const reading1 = showOptionContent(currentDate); // Gọi hàm showOptionContent để lấy bài đọc phụ
        if (reading1 && reading1 !== "1") {
            feastAndReadingContent += `
                <div class="readable" onclick="showBibleOptionContent('${currentDate.toISOString()}')">
                    ${reading1}
                </div>`;
        }

        // Ngày dương lịch và âm lịch được hiển thị trong cùng một ô
        const solarDateCell = document.createElement('td');
        const lunarDate = convertToLunarDate({ day, month, year });

        // Hiển thị ngày dương lịch với chữ đậm và ngày âm lịch với màu xanh đậm
        solarDateCell.innerHTML = `<strong>${day}/${month}</strong><br><em><span style="color: darkblue;">(${lunarDate.day}/${lunarDate.month})</span></em>`;
        row.appendChild(solarDateCell);

        // Màu áo lễ
        const chasubleCell = document.createElement('td');
        chasubleCell.innerHTML = `<strong>${chasuble || 'Xanh'}</strong>`; // Hiển thị màu áo lễ, nếu không có thì mặc định là 'Xanh'
        row.appendChild(chasubleCell);

        // Thông tin lễ và bài đọc
        const feastAndReadingCell = document.createElement('td');
        feastAndReadingCell.innerHTML = feastAndReadingContent;
        row.appendChild(feastAndReadingCell);

        // Nếu là Chủ Nhật, thêm hiệu ứng 3D
        if (currentDate.getDay() === 0) {
            row.classList.add('sunday');
        }

        // Gán lớp màu nền cho hàng theo chasuble
        const chasubleClass = getChasubleClass(chasuble);
        if (chasubleClass) {
            row.classList.add(chasubleClass);
        }

        // Thêm hàng vào bảng
        reportTableBody.appendChild(row);

        // Chuyển sang ngày tiếp theo
        currentDate.setDate(currentDate.getDate() + 1);
    }
}



                // các hàm phụ trợ cho hiển thị
                        // xuống 1.5 hàng khi gặp ký tự trong bài đọc
                        function formatWithLineBreaks(text) {
                            if (!text) return ''; // Kiểm tra chuỗi trống
                            // Sử dụng div với line-height để tạo khoảng cách dòng lớn hơn
                            return text.replace(/(\r\n|\n|\r)/g, '<div style="line-height: 2;"></div>'); 
                        }


                        // Hàm phụ trợ để định dạng từng bài đọc (bài đọc I, II, Tin Mừng)
                        function formatReadingPart(title, readingPart) {
                            if (!readingPart) return `<strong style="color: red;"> ${title}:</strong> Not available<br><br>`;
                            
                            return `
                                <br><strong style="color: red;">${title}:</strong> ${formatWithLineBreaks(readingPart.excerpt)} <br>
                                <br><em>${formatWithLineBreaks(readingPart.info || '')}</em><br>
                                <br><strong>${formatWithLineBreaks(readingPart.title || '')}</strong><br>
                                <br>${formatWithLineBreaks(readingPart.content || '')}<br>
                                <br><strong>${formatWithLineBreaks(readingPart.end || '')}</strong><br><br>
                            `;
                        }

                        // Hàm phụ trợ để định dạng phần Đáp ca
                        function formatPsalms(psalms) {
                            if (!psalms) return '<strong>Đáp ca:</strong> Not available<br><br>';
                            
                            return `
                                <strong style="color: red;"> Đáp ca:</strong> ${formatWithLineBreaks(psalms.excerpt)} <br>
                                <br><strong>${formatWithLineBreaks(psalms.response)}</strong><br>
                                <br><em>${psalms.verses.map(formatWithLineBreaks).join('<br><br>')}</em><br><br>
                            `;
                        }

                        // Hàm phụ trợ để định dạng phần Xướng trước Tin Mừng
                        function formatAlleluia(alleluia) {
                            if (!alleluia) return '<strong style="color: red;">Xướng trước Tin Mừng:</strong> Not available<br><br>';
                            
                            return `
                                <strong style="color: red;"> Xướng trước Tin Mừng:</strong> ${formatWithLineBreaks(alleluia.verse)} <br>
                                <br><strong>${formatWithLineBreaks(alleluia.content)}</strong><br><br>
                            `;
                        }
      
      // Các Hàm liên quan bài đọc chính
        // Hàm hiển thị nội dung bài đọc chính
        function showReadingContent(dateString) {
            const date = new Date(dateString);  // Chuyển đổi chuỗi thành đối tượng Date
            const reading = getBibleByFourDigitCode(date);  // Lấy bài đọc
            const year = date.getFullYear();
            const feasts = calculateFeasts(year); // Lấy danh sách lễ
            updateModalTitle(date, feasts); // Cập nhật tiêu đề modal
            if (reading) {
                // Biến lưu trữ nội dung bài đọc với các điều kiện kiểm tra từng phần
                const readingContent = `
                    ${formatReadingPart('Bài Đọc I', reading.firstReading)}
                    ${formatPsalms(reading.psalms)}
                    ${reading.secondReading ? formatReadingPart('Bài Đọc II', reading.secondReading) : ''} 
                    ${formatAlleluia(reading.alleluia)}
                    ${formatReadingPart('Tin Mừng', reading.gospel)}
                `;

                // Hiển thị nội dung bài đọc trong phần tử HTML có ID là "readingContent"
                document.getElementById("readingContent").innerHTML = readingContent;
            } else {
                // Không có bài đọc, hiển thị thông báo
                document.getElementById("readingContent").innerHTML = "Không có bài đọc.";
            }

            // Hiển thị modal và overlay
            document.getElementById("readingModal").style.display = "block"; 
            document.getElementById("modalOverlay").style.display = "block"; 
        }
        // Hàm hiển thị tên bài đọc chính
        function showfordayContent(date) {
            const reading = getBibleByFourDigitCode(date); // Gọi hàm để lấy bài đọc
            if (reading) {
                // Loại bỏ (Năm I) hoặc (Năm II) bất kể chữ hoa hay chữ thường
                const reading1 = reading.firstReading ? `${reading.firstReading.excerpt.replace(/\(năm i\)|\(năm ii\)/gi, '').trim()}; ` : 'Không có Bài Đọc I';
                const psalm = reading.psalms ? `${reading.psalms.excerpt}; ` : 'Không có Thánh Vịnh';
                const reading2 = reading.secondReading ? `${reading.secondReading.excerpt}; ` : '';
                const gospel = reading.gospel ? `${reading.gospel.excerpt}` : 'Không có Tin Mừng';

                // Kết hợp tất cả các phần vào một chuỗi
                const readingContent = `${reading1}${psalm}${reading2}${gospel}`;


                // Trả về chuỗi nội dung bài đọc
                return readingContent;
            } else {
                return; // Trả về chuỗi thông báo
        }
    }
      // Các hàm liên quan bài đọc phụ
          // Hàm hiển thị nội dung bài đọc phụ
            function showBibleOptionContent(dateString) {
                const date = new Date(dateString);
                const reading = getBibleByOptionDigitCode(date);  // Lấy bài đọc
                const year = date.getFullYear();
                const feasts = calculateFeasts(year); // Lấy danh sách lễ
                updateModalTitle1(date, feasts); // Cập nhật tiêu đề modal

                if (reading) {
                    // Biến lưu trữ nội dung bài đọc với các điều kiện kiểm tra từng phần
                    const readingContent = `
                        ${formatReadingPart('Bài Đọc I', reading.firstReading)}
                        ${formatPsalms(reading.psalms)}
                        ${reading.secondReading ? formatReadingPart('Bài Đọc II', reading.secondReading) : ''} 
                        ${formatAlleluia(reading.alleluia)}
                        ${formatReadingPart('Tin Mừng', reading.gospel)}
                   `;

                    // Hiển thị nội dung bài đọc trong phần tử HTML có ID là "readingContent"
                    document.getElementById("readingContent").innerHTML = readingContent;
                } else {
                    return "1";
                }

                // Hiển thị modal và overlay
                document.getElementById("readingModal").style.display = "block"; 
                document.getElementById("modalOverlay").style.display = "block"; 

            }

                // Hàm hiển thị tên bài đọc phụ
            function showOptionContent(date) {
                const reading = getBibleByOptionDigitCode(date); // tại sao báo lỗi hàm chưa được định nghĩa???
               if (reading) {
                    const reading1 = reading.firstReading ? `${reading.firstReading.excerpt}; ` : 'Không có Bài Đọc I';
                    const psalm = reading.psalms ? `${reading.psalms.excerpt}; ` : 'Không có Thánh Vịnh';
                    const reading2 = reading.secondReading ? `${reading.secondReading.excerpt}; ` : '';
                    const gospel = reading.gospel ? `${reading.gospel.excerpt}` : '';

                    // Kết hợp tất cả các phần vào một chuỗi
                    const readingContent = `${reading1}${psalm}${reading2}${gospel}`;
                     return readingContent;
                } else {
                    return '';
                }
            }



        // câu thánh kinh info cho ngày hiển thị
        function showfordayContentinfo(date) {
            const reading = getBibleByFourDigitCode(date); // Gọi hàm để lấy bài đọc
            if (reading) {
            
                const Infogospel = reading.gospel ? `${reading.gospel.info}` : '';
                // Trả về chuỗi nội dung bài đọc
                return Infogospel;
            } else {
                return; // Trả về chuỗi thông báo
            }
        }


        // Hàm định dạng tên lễ theo yêu cầu
        function formatFeastName(feastName) {
            if (feastName.includes("Lễ nhớ")) {
                const feastParts = feastName.split('.');
                if (feastParts.length > 1) {
                    const firstPart = feastParts[0] + '.';
                    const secondPart = feastParts.slice(1).join('.');
                    return `${firstPart} <span class="feast-bold">${secondPart}</span>`;
                } else {
                    return feastName;
                }
            } else if (feastName.includes("Lễ kính")) {
                return feastName.replace("Lễ kính", `<span class="feast-bold">Lễ kính</span>`);
            } else if (feastName.includes("CHÚA NHẬT")) {
                const feastParts = feastName.split('.');
                if (feastParts.length > 1) {
                    const firstPart = feastParts[0] + '.';
                    const secondPart = feastParts.slice(1).join('.');
                    return `<span class="feast-bold"> ${firstPart}</span> ${secondPart}`;
                }
            } else if (feastName.includes("Lễ trọng")) {
                return `<span class="feast-bold">${feastName}</span>`;
            }
            return feastName;
        }

        // Hàm chuyển đổi màu Chasuble thành lớp CSS cho màu nền
        function getChasubleClass(chasuble) {
            switch (chasuble) {
                case 'Tr': return 'bg-Tr'; // Màu trắng
                case 'Tm': return 'bg-Tm'; // Màu tím
                case 'Đ': return 'bg-Đ';   // Đỏ nhẹ
                case 'X': return 'bg-X';   // Xanh lá cây
                default: return '';        // Không có màu
            }
        }

        // Hàm chuyển chuỗi ngày thành đối tượng ngày
        function parseDate(dateString) {
            const [day, month, year] = dateString.split('/').map(Number);
            return { day, month, year };
        }

        // Hàm chuyển đổi ngày dương lịch sang ngày âm lịch
        function convertToLunarDate({ day, month, year }) {
            const lunarDate = getLunarDate(day, month, year);
            return lunarDate ? { day: lunarDate.day, month: lunarDate.month, year: lunarDate.year } : { day: '', month: '' };
        }

        // Hàm lấy thông tin ngày lễ từ danh sách feasts
        function getFeastForDay(solarDate, feasts) {
            for (let feast of feasts) {
                if (feast.date && solarDate.getDate() === feast.date.getDate() &&
                    solarDate.getMonth() === feast.date.getMonth() &&
                    solarDate.getFullYear() === feast.date.getFullYear()) {
                    return feast;
                }
            }
            return null;
        }
        function getSecondFeastsForDate(date, secondFeasts) {
            for (let secondFeast of secondFeasts) {
                if (secondFeast.date &&
                    date.getDate() === secondFeast.date.getDate() &&
                    date.getMonth() === secondFeast.date.getMonth() &&
                    date.getFullYear() === secondFeast.date.getFullYear()) {
                    return secondFeast; // Trả về lễ vọng nếu ngày khớp
                }
            }
            return null; // Trả về null nếu không có lễ vọng
        }

                // Hàm cập nhật thông tin ngày tháng và tên lễ trong modal
            function updateModalTitle(date, feasts) {
                const day = date.getDate();
                const month = date.getMonth() + 1; // Tháng trong JavaScript bắt đầu từ 0
                const year = date.getFullYear();

                // Lấy tên lễ từ danh sách feasts cho ngày hiện tại
                const feast = getFeastForDay(date, feasts);
                const feastName = feast ? feast.name : 'Không có lễ đặc biệt';

                // Cập nhật thẻ <h3> trong modal
                document.querySelector("#readingModal h3").textContent = `Bài Đọc Ngày: ${day}/${month}/${year} - ${feastName}`;
            }
            function updateModalTitle1(date, secondFeasts, feasts) {
                    const day = date.getDate();
                    const month = date.getMonth() + 1; // Tháng trong JavaScript bắt đầu từ 0
                    const year = date.getFullYear();

                    // Lấy các lễ vọng
                    const secondFeast1 = calculateSecondFeasts(year); 

                    // Lấy lễ vọng từ danh sách secondFeasts cho ngày hiện tại
                    const secondFeast = getSecondFeastsForDate(date, secondFeast1);
                    // Nếu có lễ vọng, lấy tên lễ vọng; nếu không, hiển thị lễ chính
                    let feastName;
                    if (secondFeast && secondFeast.name) {
                        feastName = secondFeast.name; // Lấy tên lễ vọng
                    } else {
                        const feasts = calculateFeasts(year);
                        const feast = getFeastForDay(date, feasts); // Lấy lễ chính nếu không có lễ vọng
                        feastName = feast ? feast.name : 'Không có lễ đặc biệt';
                        feastName = feastName.replace(/Thứ Hai\.|Thứ Ba\.|Thứ Tư\.|Thứ Năm\.|Thứ Sáu\.|Thứ Bảy\./g, '').trim();

                        // Thêm chuỗi "Về vị thánh" vào trước tên lễ chính
                        feastName = "Về Lễ " + feastName;
                    }

                    // Cập nhật thẻ <h3> trong modal
                    document.querySelector("#readingModal h3").textContent = `Bài Đọc Ngày: ${day}/${month}/${year} - ${feastName}`;
                }

// Tăng kích thước font
function increaseFontSize() {
    var content = document.getElementById('readingContent');
    var currentSize = window.getComputedStyle(content, null).getPropertyValue('font-size');
    var newSize = parseFloat(currentSize) + 2;
    content.style.fontSize = newSize + 'px';
}

// Giảm kích thước font
function decreaseFontSize() {
    var content = document.getElementById('readingContent');
    var currentSize = window.getComputedStyle(content, null).getPropertyValue('font-size');
    var newSize = parseFloat(currentSize) - 2;
    content.style.fontSize = newSize + 'px';
}

// Hàm thoát khỏi modal (Quit)
function quitModal() {
    // Ẩn modal và overlay
    document.getElementById('readingModal').style.display = 'none';
    document.getElementById('modalOverlay').style.display = 'none';
}

// Hàm bôi đậm nội dung (Bold)
function boldText() {
    // Lấy phần nội dung của modal
    var content = document.getElementById('readingContent');
    
    // Kiểm tra nếu nội dung đã được bôi đậm hay chưa
    if (content.style.fontWeight === 'bold') {
        content.style.fontWeight = 'normal'; // Nếu đã đậm thì chuyển về bình thường
    } else {
        content.style.fontWeight = 'bold'; // Nếu chưa đậm thì bôi đậm
    }
}

            const liturgicalYears = ['A', 'B', 'C'];

            // Hàm tính toán và trả về chu kỳ năm phụng vụ (A, B hoặc C)
            function getLiturgicalYear(year) {
                const startYear = 2020; // Năm bắt đầu cho chu kỳ
                const cycleLength = 3;  // Chu kỳ lặp lại mỗi 3 năm
                const yearOffset = year - startYear;
                const cycle = (yearOffset % cycleLength + cycleLength) % cycleLength;
                return liturgicalYears[cycle];
            }

</script>

</body>
</html>
